<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.he1pa.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Write the code, Change the world">
<meta property="og:url" content="https://www.he1pa.com/index.html">
<meta property="og:site_name" content="Write the code, Change the world">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="He1Pa">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.he1pa.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Write the code, Change the world</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Write the code, Change the world</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">46</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">9</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">30</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.he1pa.com/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/56333845?s=400&u=600fd5f50de976970544a4066a750cd59623091b&v=4">
      <meta itemprop="name" content="He1Pa">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Write the code, Change the world">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/" class="post-title-link" itemprop="url">合约审计与形式化验证</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-12-07 11:24:51 / Modified: 11:43:57" itemprop="dateCreated datePublished" datetime="2023-12-07T11:24:51+08:00">2023-12-07</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="合约审计与形式化验证-Certik-与-Move-Prover"><a href="#合约审计与形式化验证-Certik-与-Move-Prover" class="headerlink" title="合约审计与形式化验证: Certik 与 Move Prover"></a>合约审计与形式化验证: Certik 与 Move Prover</h1><p>CertiK (<a target="_blank" rel="noopener" href="https://www.certik.com/">https://www.certik.com/</a>) 是 Web3 领先的智能合约审计公司，提供一整套工具来大规模保护行业安全。Certik 通过专家审查 + AI + 形式化验证保障合约安全。<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/Certik.png" alt="Certik"></p>
<p>Certik 对智能合约的形式化验证主要过程为:</p>
<ol>
<li>将合同的规范和所需属性定义为形式化语言。</li>
<li>将合约代码翻译成形式化表示，例如数学模型或逻辑。</li>
<li>使用自动定理证明器或模型检查器来验证合约的规范和属性是否成立。</li>
<li>重复验证过程以查找并修复与所需属性的任何错误或偏差。</li>
</ol>
<p>Certik 使用 SMT Solver 和 Coq 作为形式化验证的工具。</p>
<ul>
<li>SMT: <a target="_blank" rel="noopener" href="https://www.certik.com/resources/blog/6nL1ogDyekFC7nfCt9n0LR-formal-verification-of-erc-20-tokens-part-one">Formal Verification of ERC-20 Tokens</a></li>
<li>Coq: <ul>
<li><a target="_blank" rel="noopener" href="https://www.certik.com/resources/blog/gt2VYhKbigwcysl50fkJS-advanced-web3-formal-verification-of-hyperenclaves-tee">Advanced Web3 Formal Verification of HyperEnclave’s TEE</a></li>
<li><a target="_blank" rel="noopener" href="https://www.certik.com/resources/blog/4ogMxJAy7dsREQhYbDIsVK-formal-verification-of-ton-master-chain-contracts">Formal Verification of TON Master Chain Contracts</a></li>
<li><a target="_blank" rel="noopener" href="https://www.certik.com/resources/blog/2s2MLGm54I6uLYOE5pS9Na-how-to-formally-verify-a-cosmos-sdk-standard-module">How to Formally Verify A Cosmos SDK Standard Module</a></li>
</ul>
</li>
</ul>
<p>Certik 在更多的案例中使用了 Coq。Coq 是一个交互式的形式化验证工具。 它提供了一种用于编写数学定义、可执行算法和定理的形式语言，以及用于机器检查证明的半交互式开发的环境。</p>
<blockquote>
<p>Coq 证明助手: <a target="_blank" rel="noopener" href="https://yuque.antfin-inc.com/vl7kr4/st175p/lb1fnk">https://yuque.antfin-inc.com/vl7kr4/st175p/lb1fnk</a></p>
</blockquote>
<p>Move 是一种用于编写智能合约的特定领域编程语言。 它被几个最近启动的项目使用，包括 Aptos、0L 和  Starcoin 区块链。  Move 开发环境包括一个名为“Move Prover”的检查器。</p>
<p>Move 编程语言有一个规范子语言，允许程序员声明有关 Move 程序的所需属性。特别是，Move Prover 遵循合约范式设计。 在内部，Move Prover 将 Move 程序及其规范转换为数学模型，然后使用演绎验证器 Boogie 对其进行形式化验证。 Boogie 使用 Z3 和 CVC4 等 SMT 求解器作为决策程序来进行证明。 一旦 Boogie 完成形式验证，其结果就会映射回 Move 语言级别并显示给程序员。<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/Move.png" alt="Move"></p>
<p>SMT（<strong>satisfiability modulo theories</strong>） 求解器是 找到一组约束的可满足解:  x - y = 3  x + y = 5 =&gt; x = 4 y = 1<br>合约/软件验证:  源代码 -&gt; 建模 -&gt; 约束 -&gt; 对约束的反例求解 -&gt; 有解则不满足约束，无解则满足约束<br>约束 x = y， 验证时: 对于 x != y，求解。所以 SMT 验证时的结果是给出一个反例和对应不满足的约束</p>
<h2 id="Coq-和-Move-Prover-的区别"><a href="#Coq-和-Move-Prover-的区别" class="headerlink" title="Coq 和 Move Prover 的区别"></a>Coq 和 Move Prover 的区别</h2><p>用一个简单的例子感受 Coq 和 Move Prover之间的区别。</p>
<p>写一个 ERC20 中 transfer 函数，其实现与表示代币从一个合约地址转移到另一个地址。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">uint sender;</span><br><span class="line">uint receiver;</span><br><span class="line">uint totalSupply;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Transfer money from User 1 to User 2.</span></span><br><span class="line">function <span class="title function_ invoke__">transfer</span>(uint amount) &#123;</span><br><span class="line">    sender = sender - amount;</span><br><span class="line">    receiver = receiver + amount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个合约实际上要求 sender &gt;=  amount，但在这个代码中并没有检查。接下来使用 Coq 和 Move Prover 来检查这一“漏洞”。</p>
<h3 id="Coq"><a href="#Coq" class="headerlink" title="Coq"></a>Coq</h3><p>形式验证需要证明程序的模型满足所声明的属性。在这个例子中，可以选择代币总数作为不变量，验证“交易前后代币不变这一属性”。即交易前的 sender, receiver 和交易后的sender’, receiver’ 满足  sender + receiver = sender’ + receiver’ </p>
<p>Certik 在使用 Coq 进行合约审计时，会将合约的实现翻译为 Coq 函数。我们将这个函数翻译为 Coq 中的一个 Definition。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Definition <span class="title function_ invoke__">transfer</span> (sender receiver amount : nat) : nat :=</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">sender</span>&#x27; := sender - amount <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">let</span> <span class="variable">receiver</span>&#x27; := receiver + amount <span class="keyword">in</span></span><br><span class="line">  sender&#x27; + receiver&#x27;.</span><br></pre></td></tr></table></figure>
<p>Coq是函数式编程语言，无副作用。不能直接更改输入的 sender receiver 的值。可以选择将交易后的 sender’ receiver’ 作为返回值，这里选择直接返回 sender’ + receiver’</p>
<p>然后，将模型需要满足的属性翻译为 Coq 中的引理。<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Lemma transfer_eq : <span class="title function_ invoke__">forall</span> (a b c : nat),</span><br><span class="line">  a + b = transfer a b c.</span><br></pre></td></tr></table></figure><br>这表示对于任意的自然数 a b c,  a + b = transfer(a, b, c)</p>
<p>在开始证明之前，还需要引入一些Coq的标准库来辅助证明<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Require Import Arith.</span><br></pre></td></tr></table></figure></p>
<p>使用 Proof. 来开始证明<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Proof.</span><br><span class="line">  intros a b c.</span><br><span class="line">  unfold transfer.</span><br><span class="line">  <span class="title function_ invoke__">rewrite</span> (Nat.add_comm b c).</span><br><span class="line">  rewrite Nat.add_assoc.</span><br><span class="line">  rewrite Nat.sub_add.</span><br><span class="line">  reflexivity.</span><br><span class="line">Abort.</span><br></pre></td></tr></table></figure></p>
<p>Coq 是一个交互式的定理证明工具。在执行每一个证明语句后，证明的目标会发生改变。通过将证明的目标拆解为子目标，然后利用现有条件或公理、性质和已证明的引理来逐个证明。</p>
<p>一开始，证明的目标为:<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/Coq1.png" alt="Coq1"><br>使用 intros 引入 a b c 作为已知条件<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/Coq2.png" alt="Coq2"><br>展开 transfer 函数<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/Coq3.png" alt="Coq3"><br>接下来使用标准库中的 Nat.add_comm Nat.add_assoc Nat.sub_add 来重写目标中的表达式<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/Coq4.png" alt="Coq4"><br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/Coq5.png" alt="Coq5"></p>
<p>对于 Nat.sub_add， 查看其定义:<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/Coq6.png" alt="Coq6"><br>表示对于任意的自然数 n m, n &lt;= m 时， m - n + n = m<br>对应此时目标中等号右边的  a - c + c。使用 Nat.sub_add 重写，<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/Coq7.png" alt="Coq7"><br>这里引入了新的目标，即 c &lt;= a。是因为使用 Nat.sub_add 重写的前提为 c &lt;= a。即将证明的目标反推，如果证明了 c &lt;= a，并且 a + b = a + b，那么利用 Nat.sub_add 这一引理，就可以证明 a + b = a - c + c + b。<br>利用自反性(reflexivity)可以证明第一个目标。<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/Coq8.png" alt="Coq8"></p>
<p>此时对于 c &lt;= a 无从下手，只能 Abort 放弃证明，合约模型不满足这一属性。</p>
<p>此时回顾 c 和 a 在合约中的定义，分别表示amount 和 sender 的金额，这一条件要求 amount &lt;= sender，很容易发现合约“漏洞”。</p>
<p>完整代码：<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Require Import Arith.</span><br><span class="line"></span><br><span class="line">Definition <span class="title function_ invoke__">transfer</span> (sender receiver amount : nat) : nat :=</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">sender</span>&#x27; := sender - amount <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">let</span> <span class="variable">receiver</span>&#x27; := receiver + amount <span class="keyword">in</span></span><br><span class="line">  sender&#x27; + receiver&#x27;.</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">Lemma transfer_eq : <span class="title function_ invoke__">forall</span> (a b c : nat),</span><br><span class="line">  a + b = transfer a b c.</span><br><span class="line">  </span><br><span class="line">Proof.</span><br><span class="line">  intros a b c.</span><br><span class="line">  unfold transfer.</span><br><span class="line">  <span class="title function_ invoke__">rewrite</span> (Nat.add_comm b c).</span><br><span class="line">  rewrite Nat.add_assoc.</span><br><span class="line">  rewrite Nat.sub_add.</span><br><span class="line">  reflexivity.</span><br><span class="line">Abort.</span><br></pre></td></tr></table></figure></p>
<p>在线体验： <a target="_blank" rel="noopener" href="https://coq.vercel.app/scratchpad.html">https://coq.vercel.app/scratchpad.html</a></p>
<h3 id="Move-prover"><a href="#Move-prover" class="headerlink" title="Move prover"></a>Move prover</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module <span class="number">0x1234</span>::test &#123;</span><br><span class="line">    fun <span class="title function_ invoke__">transfer</span>(sender: <span class="type">u64</span>, receiver: <span class="type">u64</span>, value: <span class="type">u64</span>): <span class="type">u64</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">_sender</span>: <span class="type">u64</span> = sender - value;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">_receiver</span>: <span class="type">u64</span> = receiver + value;</span><br><span class="line">        _sender + _receiver</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    spec transfer &#123;</span><br><span class="line">        pragma aborts_if_is_strict;</span><br><span class="line">        ensures result == sender + receiver;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行 move prove<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/moveres.png" alt="move result"></p>
<p>验证过程中，还会在当前项目目录下生成 boogie ir 的文件 xxx.bpl<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fun test::transfer [verification] at ./sources/main.move:2:5+183</span></span><br><span class="line">procedure &#123;:timeLimit <span class="number">40</span>&#125; $<span class="number">1234_</span>test_transfer$<span class="title function_ invoke__">verify</span>(_$t0: int, _$t1: int, _$t2: int) <span class="title function_ invoke__">returns</span> ($ret0: int)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// declare local variables</span></span><br><span class="line">    var $t3: int;</span><br><span class="line">    var $t4: int;</span><br><span class="line">    var $t5: int;</span><br><span class="line">    var $t6: int;</span><br><span class="line">    var $t7: int;</span><br><span class="line">    var $t8: int;</span><br><span class="line">    var $t0: int;</span><br><span class="line">    var $t1: int;</span><br><span class="line">    var $t2: int;</span><br><span class="line">    var $temp_0<span class="symbol">&#x27;u64</span>&#x27;: int;</span><br><span class="line">    $t0 := _$t0;</span><br><span class="line">    $t1 := _$t1;</span><br><span class="line">    $t2 := _$t2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// verification entrypoint assumptions</span></span><br><span class="line">    call $<span class="title function_ invoke__">InitVerification</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// bytecode translation starts here</span></span><br><span class="line">    <span class="comment">// assume WellFormed($t0) at ./sources/main.move:2:5+1</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$at(2,26,27)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">    assume $IsValid<span class="symbol">&#x27;u64</span>&#x27;($t0);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assume WellFormed($t1) at ./sources/main.move:2:5+1</span></span><br><span class="line">    assume $IsValid<span class="symbol">&#x27;u64</span>&#x27;($t1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assume WellFormed($t2) at ./sources/main.move:2:5+1</span></span><br><span class="line">    assume $IsValid<span class="symbol">&#x27;u64</span>&#x27;($t2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// trace_local[sender]($t0) at ./sources/main.move:2:5+1</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$track_local(0,0,0):&quot;</span>, $t0&#125; $t0 == $t0;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// trace_local[receiver]($t1) at ./sources/main.move:2:5+1</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$track_local(0,0,1):&quot;</span>, $t1&#125; $t1 == $t1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// trace_local[value]($t2) at ./sources/main.move:2:5+1</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$track_local(0,0,2):&quot;</span>, $t2&#125; $t2 == $t2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $t5 := -($t0, $t2) on_abort goto L2 with $t6 at ./sources/main.move:3:35+1</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$at(2,120,121)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">    call $t5 := $<span class="title function_ invoke__">Sub</span>($t0, $t2);</span><br><span class="line">    <span class="title function_ invoke__">if</span> ($abort_flag) &#123;</span><br><span class="line">        assume &#123;:print <span class="string">&quot;$at(2,120,121)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">        $t6 := $abort_code;</span><br><span class="line">        assume &#123;:print <span class="string">&quot;$track_abort(0,0):&quot;</span>, $t6&#125; $t6 == $t6;</span><br><span class="line">        goto L2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// trace_local[_sender]($t5) at ./sources/main.move:3:13+7</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$track_local(0,0,4):&quot;</span>, $t5&#125; $t5 == $t5;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $t7 := +($t1, $t2) on_abort goto L2 with $t6 at ./sources/main.move:4:39+1</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$at(2,167,168)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">    call $t7 := $<span class="title function_ invoke__">AddU64</span>($t1, $t2);</span><br><span class="line">    <span class="title function_ invoke__">if</span> ($abort_flag) &#123;</span><br><span class="line">        assume &#123;:print <span class="string">&quot;$at(2,167,168)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">        $t6 := $abort_code;</span><br><span class="line">        assume &#123;:print <span class="string">&quot;$track_abort(0,0):&quot;</span>, $t6&#125; $t6 == $t6;</span><br><span class="line">        goto L2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// trace_local[_receiver]($t7) at ./sources/main.move:4:13+9</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$track_local(0,0,3):&quot;</span>, $t7&#125; $t7 == $t7;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $t8 := +($t5, $t7) on_abort goto L2 with $t6 at ./sources/main.move:5:17+1</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$at(2,192,193)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">    call $t8 := $<span class="title function_ invoke__">AddU64</span>($t5, $t7);</span><br><span class="line">    <span class="title function_ invoke__">if</span> ($abort_flag) &#123;</span><br><span class="line">        assume &#123;:print <span class="string">&quot;$at(2,192,193)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">        $t6 := $abort_code;</span><br><span class="line">        assume &#123;:print <span class="string">&quot;$track_abort(0,0):&quot;</span>, $t6&#125; $t6 == $t6;</span><br><span class="line">        goto L2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// trace_return[0]($t8) at ./sources/main.move:5:9+19</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$track_return(0,0,0):&quot;</span>, $t8&#125; $t8 == $t8;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// label L1 at ./sources/main.move:6:5+1</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$at(2,208,209)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">L1:</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assert Not(false) at ./sources/main.move:6:5+1</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$at(2,208,209)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">    assert &#123;:msg <span class="string">&quot;assert_failed(2,208,209): function does not abort under this condition&quot;</span>&#125;</span><br><span class="line">      !<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assert Eq&lt;u64&gt;($t8, Add($t0, $t1)) at ./sources/main.move:10:9+36</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$at(2,275,311)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">    assert &#123;:msg <span class="string">&quot;assert_failed(2,275,311): post-condition does not hold&quot;</span>&#125;</span><br><span class="line">      $IsEqual<span class="symbol">&#x27;u64</span>&#x27;($t8, ($t0 + $t1));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return $t8 at ./sources/main.move:10:9+36</span></span><br><span class="line">    $ret0 := $t8;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// label L2 at ./sources/main.move:6:5+1</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$at(2,208,209)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">L2:</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assert false at ./sources/main.move:8:5+102</span></span><br><span class="line">    assume &#123;:print <span class="string">&quot;$at(2,215,317)&quot;</span>&#125; <span class="literal">true</span>;</span><br><span class="line">    assert &#123;:msg <span class="string">&quot;assert_failed(2,215,317): abort not covered by any of the `aborts_if` clauses&quot;</span>&#125;</span><br><span class="line">      <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// abort($t6) at ./sources/main.move:8:5+102</span></span><br><span class="line">    $abort_code := $t6;</span><br><span class="line">    $abort_flag := <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<ul>
<li>print: 打印调试信息，不影响执行</li>
<li>$at 是一个 Boogie 的内置函数，用于指示某个语句或表达式的位置信息</li>
<li>L1 L2， label，程序执行流程控制</li>
<li>assume:  做一些前提假设。例如，assume WellFormed($t0) 表示假设 $t0 是一个合法的 Move 类型，并且 assume $IsValid’u64’($t0) 表示假设 $t0 是一个有效的无符号 64 位整数。这些假设在验证过程中用于推导其他断言。</li>
<li>$abort_flag: 表示是否发生了异常（abort）</li>
<li>assert: 断言，它用于在程序执行期间检查某个条件是否满足。如果断言条件为真，则程序继续执行；如果断言条件为假，则会导致验证失败。 例如     assert {:msg “assert_failed(2,275,311): post-condition does not hold”}</li>
</ul>
<h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><p>Coq<br>优点：</p>
<ul>
<li>从数学上证明，避免测试的 corner case</li>
<li>形式化的规范避免自然语言中的模糊和歧义</li>
<li>相对于 SMT，定理证明可以处理对无限状态系统的分析。上述例子中具体表现入参的区别， Coq 中可以对自然数域（nat 类型）做验证，而smt只能对有限的输入做验证</li>
</ul>
<p>缺点</p>
<ul>
<li>需要手动 translate，将智能合约的实现翻译为 Coq 代码，翻译的过程中可能导致 Coq 代码和原合约代码语义上的区别，例如 transfer 中 uint 变量类型被翻译为 nat</li>
<li>需要证明的合约满足的属性是不明确的。错误的约束可能会将漏洞从代码带到规范中，而不恰当的约束也可能导致错误不能被检查。这一点不只是coq，move prover 同样需要人为定义spec</li>
<li>Coq需要手动证明，成本高，需要验证人员对 Coq 和智能合约都有认知。同时 Coq 证明也很复杂， Certik 在验证 TEE 时用了数千行的规范和 17300 多行的证明代码</li>
<li>过于 Customize，可以作为 Case by Case 的服务，但不太好沉淀为通用的解决方案。</li>
</ul>
<p>Move prover<br>优点</p>
<ul>
<li>SMT 是自动求解的，不需要像Coq一样手动构造证明</li>
<li>更通用，完成语言前端到 boogie IR 的翻译之后，基本上所有语言都可以使用这个方案</li>
</ul>
<p>缺点</p>
<ul>
<li>语言设计时需要遵循SMT的约束，因此Move语言的能力有很大的限制，仅基础类型就不支持 int(只有 u8 u32 u64)， string， map</li>
<li>spec 很难写: <a target="_blank" rel="noopener" href="https://github.com/move-language/move/blob/main/language/move-prover/doc/user/spec-lang.md">https://github.com/move-language/move/blob/main/language/move-prover/doc/user/spec-lang.md</a></li>
<li>SMT 存在状态爆炸和可判定问题<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Decision_problem">https://en.wikipedia.org/wiki/Decision_problem</a></li>
</ul>
<h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p>符号执行<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/symbolic.png" alt="symbolic"></p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/HW-PLLab/pllab_slides/blob/dev/WechatOfficialAccSlides/20230223-%E7%AC%A6%E5%8F%B7%E5%8C%96%E6%89%A7%E8%A1%8C%E5%9C%A8%E8%BD%AF%E4%BB%B6%E9%A2%86%E5%9F%9F%E7%9A%84%E5%BA%94%E7%94%A8%E5%8F%8A%E6%8C%91%E6%88%98-by-%E6%B2%88%E8%AF%97%E7%90%A6.pdf">https://gitee.com/HW-PLLab/pllab_slides/blob/dev/WechatOfficialAccSlides/20230223-%E7%AC%A6%E5%8F%B7%E5%8C%96%E6%89%A7%E8%A1%8C%E5%9C%A8%E8%BD%AF%E4%BB%B6%E9%A2%86%E5%9F%9F%E7%9A%84%E5%BA%94%E7%94%A8%E5%8F%8A%E6%8C%91%E6%88%98-by-%E6%B2%88%E8%AF%97%E7%90%A6.pdf</a></p>
<p>合约语言验证技术对比<br><img src="/2023/12/07/%E5%90%88%E7%BA%A6%E5%AE%A1%E8%AE%A1%E4%B8%8E%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81/methods.png" alt="mothods"><br>Solana Certora Prover 和 solidity SMTCheck 也是基于 SMT 的方案。<br>DeepSea 能采用 Coq 作为验证工具，大概率是因为语言使用 Ocaml 实现，Coq 由 Ocaml 语言实现且 Coq 代码可以提取为 Ocaml 代码，两者之间存在一些可转换性。</p>
<h1 id="Todo"><a href="#Todo" class="headerlink" title="Todo"></a>Todo</h1><p>Solana Certora Prover (SCP) </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://medium.com/certora/formal-verification-of-solana-smart-contracts-2e57b960f953">https://medium.com/certora/formal-verification-of-solana-smart-contracts-2e57b960f953</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/certora/formal-verification-of-spl-token-2022-d521db465c2e">https://medium.com/certora/formal-verification-of-spl-token-2022-d521db465c2e</a></li>
</ul>
<p>Solidity SMTCheck</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/v0.8.15/smtchecker.html">https://docs.soliditylang.org/en/v0.8.15/smtchecker.html</a></li>
<li><a target="_blank" rel="noopener" href="https://runtimeverification.com/blog/how-formal-verification-of-smart-contracts-works">https://runtimeverification.com/blog/how-formal-verification-of-smart-contracts-works</a></li>
</ul>
<h1 id="Ref："><a href="#Ref：" class="headerlink" title="Ref："></a>Ref：</h1><ul>
<li><a target="_blank" rel="noopener" href="https://ethereum.org/zh/developers/docs/smart-contracts/formal-verification/">https://ethereum.org/zh/developers/docs/smart-contracts/formal-verification/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.certik.com/resources/blog/gt2VYhKbigwcysl50fkJS-advanced-web3-formal-verification-of-hyperenclaves-tee">Advanced Web3 Formal Verification of HyperEnclave’s TEE</a></li>
<li><a target="_blank" rel="noopener" href="https://www.certik.com/resources/blog/4ogMxJAy7dsREQhYbDIsVK-formal-verification-of-ton-master-chain-contracts">Formal Verification of TON Master Chain Contracts</a></li>
<li><a target="_blank" rel="noopener" href="https://www.certik.com/resources/blog/2s2MLGm54I6uLYOE5pS9Na-how-to-formally-verify-a-cosmos-sdk-standard-module">How to Formally Verify A Cosmos SDK Standard Module</a></li>
<li><a target="_blank" rel="noopener" href="https://www.certik.com/resources/blog/6nL1ogDyekFC7nfCt9n0LR-formal-verification-of-erc-20-tokens-part-one">Formal Verification of ERC-20 Tokens</a></li>
<li>What is Formal Verification in Smart Contract Auditing? <a target="_blank" rel="noopener" href="https://www.certik.com/resources/blog/3UDUMVAMia8ZibM7EmPf9f-what-is-formal-verification">https://www.certik.com/resources/blog/3UDUMVAMia8ZibM7EmPf9f-what-is-formal-verification</a></li>
<li>An Introduction to Move  <a target="_blank" rel="noopener" href="https://www.certik.com/resources/blog/3o4Cg1cjQH4IwA88aT8OwT-an-introduction-to-move">https://www.certik.com/resources/blog/3o4Cg1cjQH4IwA88aT8OwT-an-introduction-to-move</a></li>
<li>Formal Verification, the Move Language, and the Move Prover <a target="_blank" rel="noopener" href="https://www.certik.com/resources/blog/2wSOZ3mC55AB6CYol6Q2rP-formal-verification-the-move-language-and-the-move-prover">https://www.certik.com/resources/blog/2wSOZ3mC55AB6CYol6Q2rP-formal-verification-the-move-language-and-the-move-prover</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/move-language/move">https://github.com/move-language/move</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Zellic/move-prover-examples">https://github.com/Zellic/move-prover-examples</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/leonardoalt/ethereum_formal_verification_overview"><strong>https://github.com/leonardoalt/ethereum_formal_verification_overview</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://research.facebook.com/file/168513165302305/The-Move-Prover.pdf">https://research.facebook.com/file/168513165302305/The-Move-Prover.pdf</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.he1pa.com/2023/05/31/Rustc%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A003-Lint%E7%9A%84%E6%89%A7%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/56333845?s=400&u=600fd5f50de976970544a4066a750cd59623091b&v=4">
      <meta itemprop="name" content="He1Pa">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Write the code, Change the world">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/31/Rustc%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A003-Lint%E7%9A%84%E6%89%A7%E8%A1%8C/" class="post-title-link" itemprop="url">Rustc源码学习03-Lint的执行</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-05-31 18:10:05 / Modified: 18:27:48" itemprop="dateCreated datePublished" datetime="2023-05-31T18:10:05+08:00">2023-05-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rust/" itemprop="url" rel="index"><span itemprop="name">Rust</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/05/31/Rustc%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A003-Lint%E7%9A%84%E6%89%A7%E8%A1%8C/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/05/31/Rustc%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A003-Lint%E7%9A%84%E6%89%A7%E8%A1%8C/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Lint-的执行流程"><a href="#Lint-的执行流程" class="headerlink" title="Lint 的执行流程"></a>Lint 的执行流程</h1><p>前面两篇介绍了 <code>Lint</code>，<code>LintPass</code> 和 <code>CombinedLintPass</code> 几个结构的实现，并以这些结构写了一个 Lint 的伪代码实现。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">ast_visit</span>::Visitor <span class="keyword">for</span> <span class="title class_">Linter</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_crate</span>(a: ast:<span class="keyword">crate</span>)&#123;</span><br><span class="line">        combinedlintpass.<span class="title function_ invoke__">check_crate</span>(a);</span><br><span class="line">        <span class="title function_ invoke__">walk_crate</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_stmt</span>(a: ast:stmt)&#123;</span><br><span class="line">        combinedlintpass.<span class="title function_ invoke__">check_stmt</span>(a)</span><br><span class="line">        <span class="title function_ invoke__">walk_stmt</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Rustc-中-Lint-的执行阶段"><a href="#Rustc-中-Lint-的执行阶段" class="headerlink" title="Rustc 中 Lint 的执行阶段"></a>Rustc 中 Lint 的执行阶段</h2><p>Rustc 的设计与经典编译器的设计基本无异，包含词法分析、语法分析、语义分析、生成IR、IR优化和代码生成等流程，但针对 Rust 的语言特性，还加入了一些特有的流程，如借用检查。对应的，代码在整个编译流程中的中间表示也有一定的扩展：</p>
<ul>
<li>Token stream：Lexer 将源代码的字符流转化为词法单元（token） 流，这些词法单元被传递给下一个步骤，即语法分析。</li>
<li>Abstract Syntax Tree(AST)：Parser 将 Token 流转换为抽象语法树（AST），抽象语法树几乎可以完全描述源代码中所写的内容。在 AST 上，Rustc 还执行了宏扩展、 early lint 等过程。</li>
<li>High-level IR(HIR)：这是一种脱糖的 AST。它仍与源代码中的内容非常接近，但它包含一些隐含的东西，例如一些省略的生命周期等。这个 IR 适合类型检查。late lint也在类型检查之后进行。</li>
<li>Typed HIR(THIR)：THIR 与 HIR 类似，但它携带了类型信息，并且更加脱糖（例如，函数调用和隐式的间接引用都会变成完全显式）。</li>
<li>Middle-level IR(MIR)：MIR 基本上是一个控制流图（Control-Flow Graph）。CFG 是程序执行过程的抽象表现，代表了程序执行过程中会遍历到的所有路径。它用图的形式表示一个过程内所有基本块可能流向。Rustc 在 MIR 上除了基础的基于 CFG 的静态分析和 IR 优化外，还进行了 Rust 中所有权的借用检查。</li>
<li>LLVM IR：Rustc 的后端采用了 LLVM，因此，Rustc 会将 MIR 进一步转化为 LLVM IR 并传递给 LLVM 做进一步优化和代码生成的工作。</li>
</ul>
<p>以上 Rust 代码的中间表示的转化流程也反映了 Rust 整个编译的流程，总结为一张图：<br><img src="/2023/05/31/Rustc%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A003-Lint%E7%9A%84%E6%89%A7%E8%A1%8C/compiler_process.jpg" alt="编译流程"><br>Rustc 中的 <code>rustc_driver::lib.rs</code> 中控制了编译流程的各个阶段：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fn run_compiler(...) -&gt; interface::Result&lt;()&gt; &#123;</span><br><span class="line">    ...</span><br><span class="line">    interface::run_compiler(config, |compiler| &#123;</span><br><span class="line">        <span class="built_in">let</span> linker = compiler.enter(|queries| &#123;</span><br><span class="line">            ...</span><br><span class="line">            queries.parse()?;   // lexer parse</span><br><span class="line">            ...</span><br><span class="line">            queries.expansion()?; // resolver</span><br><span class="line">            ...</span><br><span class="line">            queries.prepare_outputs()?;</span><br><span class="line">            ...</span><br><span class="line">            queries.global_ctxt()?; // ast -&gt; hir</span><br><span class="line">            ...</span><br><span class="line">            queries.ongoing_codegen()?;</span><br><span class="line">            ...</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前面介绍过，Rustc 中的 Lint 包含 early 和 late 两种，它们分别在 AST -&gt; HIR 和 HIR -&gt; THIR 两个阶段执行。这里我们同样以 <code>WhileTrue</code> 这个例子去看 Lint 从定义、到注册，最后执行的完整的流程。同时，<code>WhileTrue</code> 是 builtin 的 early lint 其中的一种，被包含在 <code>BuiltinCombinedEarlyLintPass</code> 之中。</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>首先是 <code>WhileTrue</code>的 lint 和对应的 lintpass 的定义，它们被定义在  <code>rustc_lint/src/builtin.rs</code> 中</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">declare_lint! &#123;</span><br><span class="line">    <span class="comment">/// The `while_true` lint detects `while true &#123; &#125;`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// ### Example</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// ```rust,no_run</span></span><br><span class="line">    <span class="comment">/// while true &#123;</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// &#125;</span></span><br><span class="line">    <span class="comment">/// ```</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// &#123;&#123;produces&#125;&#125;</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// ### Explanation</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// `while true` should be replaced with `loop`. A `loop` expression is</span></span><br><span class="line">    <span class="comment">/// the preferred way to write an infinite loop because it more directly</span></span><br><span class="line">    <span class="comment">/// expresses the intent of the loop.</span></span><br><span class="line">    WHILE_TRUE,</span><br><span class="line">    Warn,</span><br><span class="line">    <span class="string">&quot;suggest using `loop &#123; &#125;` instead of `while true &#123; &#125;`&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare_lint_pass!(WhileTrue =&gt; [WHILE_TRUE]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">EarlyLintPass</span> <span class="keyword">for</span> <span class="title class_">WhileTrue</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">check_expr</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, cx: &amp;EarlyContext&lt;<span class="symbol">&#x27;_</span>&gt;, e: &amp;ast::Expr) &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与前面的介绍一样：</p>
<ol>
<li><code>declare_lint</code> 宏声明一个 lint：<code>WHILE_TRUE</code></li>
<li><code>declare_lint_pass</code> 宏声明一个lintpass：<code>WhileTrue</code></li>
<li>为 <code>WhileTrue</code> 实现 <code>EarlyLintPass</code> 中对应的检查方法，因为此 lintpass 只检查 Expr 节点，所以只需要实现 <code>check_expr()</code>函数即可。</li>
</ol>
<h2 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h2><p>注册是指编译过程中将 Lint 加入到 LintStore 的过程。<code>WhileTrue</code> 不需要单独的注册和执行，它的检查方法通过宏扩展的方式展开到 <code>BuiltinCombinedEarlyLintPass</code> 中。<code>BuiltinCombinedEarlyLintPass</code> 的注册和执行都发生在 <code>queries.expansion()</code> 函数中。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">expansion</span>(</span><br><span class="line">    &amp;<span class="keyword">self</span>,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;&amp;Query&lt;(Rc&lt;ast::Crate&gt;, Rc&lt;RefCell&lt;BoxedResolver&gt;&gt;, Lrc&lt;LintStore&gt;)&gt;&gt; &#123;</span><br><span class="line">    tracing::trace!(<span class="string">&quot;expansion&quot;</span>);</span><br><span class="line">    <span class="keyword">self</span>.expansion.<span class="title function_ invoke__">compute</span>(|| &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">crate_name</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">crate_name</span>()?.<span class="title function_ invoke__">peek</span>().<span class="title function_ invoke__">clone</span>();</span><br><span class="line">        <span class="comment">// 注册</span></span><br><span class="line">        <span class="keyword">let</span> (krate, lint_store) = <span class="keyword">self</span>.<span class="title function_ invoke__">register_plugins</span>()?.<span class="title function_ invoke__">take</span>(); </span><br><span class="line">        <span class="keyword">let</span> <span class="variable">_timer</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">session</span>().<span class="title function_ invoke__">timer</span>(<span class="string">&quot;configure_and_expand&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">sess</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">session</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">resolver</span> = passes::<span class="title function_ invoke__">create_resolver</span>(</span><br><span class="line">            sess.<span class="title function_ invoke__">clone</span>(),</span><br><span class="line">            <span class="keyword">self</span>.<span class="title function_ invoke__">codegen_backend</span>().<span class="title function_ invoke__">metadata_loader</span>(),</span><br><span class="line">            &amp;krate,</span><br><span class="line">            &amp;crate_name,</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">krate</span> = resolver.<span class="title function_ invoke__">access</span>(|resolver| &#123;</span><br><span class="line">            <span class="comment">// 执行</span></span><br><span class="line">            passes::<span class="title function_ invoke__">configure_and_expand</span>(sess, &amp;lint_store, krate, &amp;crate_name, resolver)</span><br><span class="line">        &#125;)?;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>((Rc::<span class="title function_ invoke__">new</span>(krate), Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(resolver)), lint_store))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注册的过程会生成定义的 lint 的结构并添加到 <a target="_blank" rel="noopener" href="https://rustc-dev-guide.rust-lang.org/diagnostics/lintstore.html">LintStore</a> 中。Lint 整体上被分为4个种类：pre-expansion, early, late,  late-module。尽管 Lint 对应的 LintPass 在编译流程中执行的阶段不同，但注册都是发生在同一个阶段。<br>Lint 注册过程的函数调用链路如下：</p>
<ul>
<li>rustc_driver::lib::run_compiler()</li>
<li>rustc_interface::queries::Queries.expansion()</li>
<li>rustc_interface::queries::Queries.register_plugins()</li>
<li>rustc_lint::lib::new_lint_store()</li>
<li>rustc_lint::lib::register_builtins()</li>
</ul>
<p>在这里，默认的编译流程会执行 else{} 分支中的语句，BuiltinCombinedEarlyLintPass::get_lints() 会生成 <code>WHILE_TRUE</code> 并添加到 LintStore中。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> no_interleave_lints &#123;</span><br><span class="line">    pre_expansion_lint_passes!(register_passes, register_pre_expansion_pass);</span><br><span class="line">    early_lint_passes!(register_passes, register_early_pass);</span><br><span class="line">    late_lint_passes!(register_passes, register_late_pass);</span><br><span class="line">    late_lint_mod_passes!(register_passes, register_late_mod_pass);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    store.<span class="title function_ invoke__">register_lints</span>(&amp;BuiltinCombinedPreExpansionLintPass::<span class="title function_ invoke__">get_lints</span>());</span><br><span class="line">    store.<span class="title function_ invoke__">register_lints</span>(&amp;BuiltinCombinedEarlyLintPass::<span class="title function_ invoke__">get_lints</span>());</span><br><span class="line">    store.<span class="title function_ invoke__">register_lints</span>(&amp;BuiltinCombinedModuleLateLintPass::<span class="title function_ invoke__">get_lints</span>());</span><br><span class="line">    store.<span class="title function_ invoke__">register_lints</span>(&amp;BuiltinCombinedLateLintPass::<span class="title function_ invoke__">get_lints</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h2><p>不同的 LintPass 的执行过程发生在编译过程的不同阶段，其中，<code>BuiltinCombinedEarlyLintPass</code> 执行过程的函数调用链路如下：</p>
<ul>
<li>rustc_driver::lib::run_compiler()</li>
<li>rustc_interface::queries::Queries.expansion()</li>
<li>rustc_interface::passes::configure_and_expand()</li>
<li>rustc_lint::early::check_ast_node()</li>
<li>rustc_lint::early::early_lint_node()</li>
</ul>
<p>首先，在 configure_and_expand() 函数中，执行了 pre-expansion 和 early 两种 lintpass。注册时使用了 BuiltinCombinedEarlyLintPass::get_lints() 方法生成 lints，而这里用 BuiltinCombinedEarlyLintPass::new() 方法生成了 lintpass。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">configure_and_expand</span>(</span><br><span class="line">    sess: &amp;Session,</span><br><span class="line">    lint_store: &amp;LintStore,</span><br><span class="line">    <span class="keyword">mut</span> krate: ast::Crate,</span><br><span class="line">    crate_name: &amp;<span class="type">str</span>,</span><br><span class="line">    resolver: &amp;<span class="keyword">mut</span> Resolver&lt;<span class="symbol">&#x27;_</span>&gt;,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;ast::Crate&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">pre_expansion_lint</span>(sess, lint_store, resolver.<span class="title function_ invoke__">registered_tools</span>(), &amp;krate, crate_name);</span><br><span class="line">    ...</span><br><span class="line">    sess.<span class="title function_ invoke__">time</span>(<span class="string">&quot;early_lint_checks&quot;</span>, || &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">lint_buffer</span> = <span class="title function_ invoke__">Some</span>(std::mem::<span class="title function_ invoke__">take</span>(resolver.<span class="title function_ invoke__">lint_buffer</span>()));</span><br><span class="line">        rustc_lint::<span class="title function_ invoke__">check_ast_node</span>(</span><br><span class="line">            sess,</span><br><span class="line">            <span class="literal">false</span>,</span><br><span class="line">            lint_store,</span><br><span class="line">            resolver.<span class="title function_ invoke__">registered_tools</span>(),</span><br><span class="line">            lint_buffer,</span><br><span class="line">            rustc_lint::BuiltinCombinedEarlyLintPass::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">            &amp;krate,</span><br><span class="line">        )</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Lint 的执行最终发生在 <code>rustc_lint::early::early_lint_node()</code> 函数中。比较 <code>early_lint_node()</code> 函数和 <code>CombinedLintPass</code> 一节最后的伪代码：</p>
<p><img src="/2023/05/31/Rustc%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A003-Lint%E7%9A%84%E6%89%A7%E8%A1%8C/early_lint_node.jpg" alt="early_lint_node与CombinedLintPass"></p>
<p>它们之间有以下的对应关系：</p>
<ul>
<li>参数 pass 是 configure_and_expand() 函数中新建的 BuiltinCombinedEarlyLintPass，它对应 combinedlintpass。</li>
<li>EarlyContextAndPass 将  pass 与 context 信息组合在一起，并且实现了 visitor，它对应 Linter。</li>
<li>check_node.check(cx) 调用了 cx.pass.check_crate() 进行 lint 检查，根据 BuiltinCombinedEarlyLintPass 的定义， 这个函数中会调用所有 builtin early lint 的 check_crate() 方法，然后执行 ast_visit::walk_crate() 遍历子节点，它对应了 visit_crate()。</li>
</ul>
<h2 id="no-interleave-lints"><a href="#no-interleave-lints" class="headerlink" title="no_interleave_lints"></a>no_interleave_lints</h2><p>虽然 Rustc 中考虑性能因素，将 LintPass 组合成 CombinedLintPass，但提供了一些编译参数去配置 Lint。其中，Lint 的注册和执行过程中都用到了 no_interleave_lints 参数。这个参数默认为 false，表示是否单独执行每一个 lint。编译时将这个修改这个参数就可以单独注册每一个 lint 以及单独执行 lintpass，这样的设计提供了更好的灵活性和自定义的能力（比如，可以对每一个 lint 单独做 benchmark）。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> no_interleave_lints &#123;</span><br><span class="line">    pre_expansion_lint_passes!(register_passes, register_pre_expansion_pass);</span><br><span class="line">    early_lint_passes!(register_passes, register_early_pass);</span><br><span class="line">    late_lint_passes!(register_passes, register_late_pass);</span><br><span class="line">    late_lint_mod_passes!(register_passes, register_late_mod_pass);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    store.<span class="title function_ invoke__">register_lints</span>(&amp;BuiltinCombinedPreExpansionLintPass::<span class="title function_ invoke__">get_lints</span>());</span><br><span class="line">    store.<span class="title function_ invoke__">register_lints</span>(&amp;BuiltinCombinedEarlyLintPass::<span class="title function_ invoke__">get_lints</span>());</span><br><span class="line">    store.<span class="title function_ invoke__">register_lints</span>(&amp;BuiltinCombinedModuleLateLintPass::<span class="title function_ invoke__">get_lints</span>());</span><br><span class="line">    store.<span class="title function_ invoke__">register_lints</span>(&amp;BuiltinCombinedLateLintPass::<span class="title function_ invoke__">get_lints</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">check_ast_node</span>&lt;<span class="symbol">&#x27;a</span>&gt;(...) &#123;</span><br><span class="line">    <span class="keyword">if</span> sess.opts.debugging_opts.no_interleave_lints &#123;</span><br><span class="line">        <span class="title function_ invoke__">for</span> (i, pass) <span class="keyword">in</span> passes.<span class="title function_ invoke__">iter_mut</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">            buffered =</span><br><span class="line">                sess.prof.<span class="title function_ invoke__">extra_verbose_generic_activity</span>(<span class="string">&quot;run_lint&quot;</span>, pass.<span class="title function_ invoke__">name</span>()).<span class="title function_ invoke__">run</span>(|| &#123;</span><br><span class="line">                    <span class="title function_ invoke__">early_lint_node</span>(</span><br><span class="line">                        sess,</span><br><span class="line">                        !pre_expansion &amp;&amp; i == <span class="number">0</span>,</span><br><span class="line">                        lint_store,</span><br><span class="line">                        registered_tools,</span><br><span class="line">                        buffered,</span><br><span class="line">                        EarlyLintPassObjects &#123; lints: slice::<span class="title function_ invoke__">from_mut</span>(pass) &#125;,</span><br><span class="line">                        check_node,</span><br><span class="line">                    )</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        buffered = <span class="title function_ invoke__">early_lint_node</span>(</span><br><span class="line">            sess,</span><br><span class="line">            !pre_expansion,</span><br><span class="line">            lint_store,</span><br><span class="line">            registered_tools,</span><br><span class="line">            buffered,</span><br><span class="line">            builtin_lints,</span><br><span class="line">            check_node,</span><br><span class="line">        );</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>至此，我们就分析了 Rustc 中一个 Lint 定义、实现对应的检查(LintPass)、注册、最终执行的完整流程。我们也可以利用这些宏，去定义新的Lint和LintPass(Clippy 中也是以相似的方式)。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.he1pa.com/2023/05/31/zk-SNARK%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/56333845?s=400&u=600fd5f50de976970544a4066a750cd59623091b&v=4">
      <meta itemprop="name" content="He1Pa">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Write the code, Change the world">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/31/zk-SNARK%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">zk-SNARK学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-05-31 17:36:52 / Modified: 18:03:48" itemprop="dateCreated datePublished" datetime="2023-05-31T17:36:52+08:00">2023-05-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web3/" itemprop="url" rel="index"><span itemprop="name">Web3</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/05/31/zk-SNARK%E5%AD%A6%E4%B9%A0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/05/31/zk-SNARK%E5%AD%A6%E4%B9%A0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><blockquote>
<p><a target="_blank" rel="noopener" href="http://people.csail.mit.edu/silvio/Selected%20Scientific%20Papers/Proof%20Systems/The_Knowledge_Complexity_Of_Interactive_Proof_Systems.pdf">http://people.csail.mit.edu/silvio/Selected%20Scientific%20Papers/Proof%20Systems/The_Knowledge_Complexity_Of_Interactive_Proof_Systems.pdf</a></p>
</blockquote>
<p>零知识协议是一种方法，通过这种方法，一方（证明者）可以向另一方（验证者）证明某事是真实的，除了证实特定声明之外，不会透露任何信息。</p>
<p>在16世纪的文艺复兴时期，意大利有两位数学家为竞争一元三次方程求根公式发现者的桂冠，就采用了零知识证明的方法。当时，数学家塔尔塔里雅和菲奥都宣称自己掌握了这个求根公式，为了证明自己没有说谎，又不把公式的具体内容公布出来(可能在当时数学公式也是一种技术秘密)，他们摆开了擂台：双方各出30个一元三次方程给对方解，谁能全部解出，就说明谁掌握了这个公式。比赛结果显示，塔尔塔里雅解出了菲奥出的全部30个方程，而菲奥一个也解不出。于是人们相信塔尔塔里雅是一元三次方程求根公式的真正发现者，虽然当时除了塔尔塔里雅外，谁也不知道这个公式到底是个什么样子。</p>
<h1 id="零知识证明的应用场景"><a href="#零知识证明的应用场景" class="headerlink" title="零知识证明的应用场景"></a>零知识证明的应用场景</h1><p><a target="_blank" rel="noopener" href="https://ethereum.org/zh/zero-knowledge-proofs/#use-cases-for-zero-knowledge-proofs">https://ethereum.org/zh/zero-knowledge-proofs/#use-cases-for-zero-knowledge-proofs</a></p>
<ul>
<li>匿名支付</li>
<li>身份保护</li>
<li>认证</li>
<li>可验证计算</li>
<li>减少链上投票中的回路和串通</li>
</ul>
<p>如何证明交易发起者？<br>每个用户都有一对公钥和密钥来管理钱包，公钥类似于银行账户的用户名，私钥类似于账户密码，账户地址是根据公钥通过不可逆算法算出来的字符串，公钥和地址都是可以公开的，私钥是需要个人妥善保管的。如果要证明这笔交易的发起方确实是小明，小明的钱包如果将私钥打包在交易中，那全网都知道了小明的私钥，相当于小明的银行卡密码被泄露了，那小明的资产就极其不安全。所以私钥不能泄露，多少比特币用户早年因为私钥丢了，结果当初不值钱的比特币现在已经是一笔巨款，简直是拍断大腿。<br>因此，接下来的问题是怎么在不泄露私钥的情况下证明这笔交易确实是有小明自己发起的，然后让网络上形成共识让这笔交易入链，交易完成后，小明才能喝到咖啡，咖啡店才能收到钱。这就是个很典型的零知识证明问题。</p>
<h1 id="零知识证明的原理"><a href="#零知识证明的原理" class="headerlink" title="零知识证明的原理"></a>零知识证明的原理</h1><p> <img src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*YD-ckgBfmmmRBCyVlhp8YQ.png" alt="image.png"></p>
<h1 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h1><p>证明  x = 3 是  x^3^+x+5 = 35 的解</p>
<h2 id="转换为计算函数"><a href="#转换为计算函数" class="headerlink" title="转换为计算函数"></a>转换为计算函数</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_ invoke__">qeval</span>(x):</span><br><span class="line">    y = x**<span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> x + y + <span class="number">5</span></span><br></pre></td></tr></table></figure>
<h2 id="拍平（flatten）"><a href="#拍平（flatten）" class="headerlink" title="拍平（flatten）"></a>拍平（flatten）</h2><p>将函数转为两种形式的语句<br>x = y<br>和<br>x = y op z<br>其中 op 可以是 +、*   （- 和 /  ？）<br>这种表达式可以看作是电路中的逻辑门，每一条语句称为一个 <code>约束</code><br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sym_1 = x * x</span><br><span class="line">y = sym_1 * x</span><br><span class="line">sym_2 = y + x</span><br><span class="line">~out = sym_2 + <span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<h2 id="R1CS"><a href="#R1CS" class="headerlink" title="R1CS"></a>R1CS</h2><p>将拍平的表达式转为 R1CS（rank-1 constraint system）电路。<br>R1CS 是一组长度为3的向量<code>(a, b, c)</code>，其中解向量 <code>s</code>满足<br>s·a * s·b - s·c = 0</p>
<blockquote>
<p>解向量 s 一般称为 witness</p>
</blockquote>
<p>向量构造方式就是拍平后的表达式的变量的系数。<br>首先将所有变量排列， ~one 表示常量 1<br><code>&#39;~one&#39;, &#39;x&#39;, &#39;~out&#39;, &#39;sym_1&#39;, &#39;y&#39;, &#39;sym_2&#39;</code></p>
<p>第一行<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sym_1 = x * x</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> * x + <span class="number">1</span> * x - <span class="number">1</span> * sym_1 = <span class="number">0</span></span><br></pre></td></tr></table></figure><br>所以<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">b = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">c = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure></p>
<p>同理，剩下3行的向量分别为<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">y = sym_1 * x</span><br><span class="line">=&gt;</span><br><span class="line">a = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">b = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">c = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">sym_2 = y + x</span><br><span class="line">=&gt;</span><br><span class="line">a = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">b = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">c = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~out = sym_2 + <span class="number">5</span></span><br><span class="line">=&gt;</span><br><span class="line">a = [<span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">b = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">c = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure></p>
<p><code>&#39;*&#39;</code> 对应系数分别在 a, b<br><code>&#39;+&#39;</code> 对应系数都在a， b的常数系数为1</p>
<p>验证一下，x = 3 时，解向量 s = [1, 3, 35, 9, 27, 30]<br>第一行:<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>] * </span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>] - </span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">= <span class="number">3</span> * <span class="number">3</span> - <span class="number">9</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure><br>第二行<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>] * </span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>] - </span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">= <span class="number">9</span> * <span class="number">3</span> - <span class="number">27</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>第三行<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>] * </span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>] - </span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">= （<span class="number">3</span> + <span class="number">27</span>）* <span class="number">1</span> - <span class="number">27</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>第四行<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>] * </span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>] - </span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">9</span>, <span class="number">27</span>, <span class="number">30</span>] · [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">= （<span class="number">5</span> + <span class="number">30</span>）* <span class="number">1</span> - <span class="number">35</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>完整的 R1CS<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">A</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">B</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">C</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure></p>
<h2 id="R1CS-gt-QAP"><a href="#R1CS-gt-QAP" class="headerlink" title="R1CS -&gt; QAP"></a>R1CS -&gt; QAP</h2><p>R1CS 可以完成证明，但对于一个解向量，验证时，有几个门电路就需要验证多少次。将 R1CS 转为 QAP(Quadratic Arithmetic Programs)，将四组三个长度为6的多项式，转变为6组3个3阶多项式。用多项式去代替向量的点积运算</p>
<blockquote>
<p>We go from four groups of three vectors of length six to six groups of three degree-3 polynomials, where evaluating the polynomials at each <em>x coordinate</em> represents one of the constraints.</p>
</blockquote>
<p>对于R1CS中的向量，转变为经过n个点的多项式（n 等于向量个数 4）<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure></p>
<p>取每一列构造坐标，行号为x，值为 y<br>A 的第一列 [0, 0, 0, 5]<br>构造坐标 (1,0),(2,0),(3,0)(4,5)， 求一个经过这四个点的多项式</p>
<p>拉格朗日插值法<br>通过n个点 (x1,y1),(x2,y2),…,(xn,yn) 的n-1阶多项式为如下所示：<br><img src="/2023/05/31/zk-SNARK%E5%AD%A6%E4%B9%A0/拉格朗日插值公式.png" alt></p>
<p>将(1,0),(2,0),(3,0)(4,5) 带入， 求得多项式 0.833 x^3 - 5x^2 + 9.166x - 5</p>
<p>同理，计算出所有的多项式系数<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">A polynomials</span><br><span class="line">[-<span class="number">5.0</span>, <span class="number">9.166</span>, -<span class="number">5.0</span>, <span class="number">0.833</span>]</span><br><span class="line">[<span class="number">8.0</span>, -<span class="number">11.333</span>, <span class="number">5.0</span>, -<span class="number">0.666</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[-<span class="number">6.0</span>, <span class="number">9.5</span>, -<span class="number">4.0</span>, <span class="number">0.5</span>]</span><br><span class="line">[<span class="number">4.0</span>, -<span class="number">7.0</span>, <span class="number">3.5</span>, -<span class="number">0.5</span>]</span><br><span class="line">[-<span class="number">1.0</span>, <span class="number">1.833</span>, -<span class="number">1.0</span>, <span class="number">0.166</span>]</span><br><span class="line"></span><br><span class="line">B polynomials</span><br><span class="line">[<span class="number">3.0</span>, -<span class="number">5.166</span>, <span class="number">2.5</span>, -<span class="number">0.333</span>]</span><br><span class="line">[-<span class="number">2.0</span>, <span class="number">5.166</span>, -<span class="number">2.5</span>, <span class="number">0.333</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line"></span><br><span class="line">C polynomials</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[-<span class="number">1.0</span>, <span class="number">1.833</span>, -<span class="number">1.0</span>, <span class="number">0.166</span>]</span><br><span class="line">[<span class="number">4.0</span>, -<span class="number">4.333</span>, <span class="number">1.5</span>, -<span class="number">0.166</span>]</span><br><span class="line">[-<span class="number">6.0</span>, <span class="number">9.5</span>, -<span class="number">4.0</span>, <span class="number">0.5</span>]</span><br><span class="line">[<span class="number">4.0</span>, -<span class="number">7.0</span>, <span class="number">3.5</span>, -<span class="number">0.5</span>]</span><br></pre></td></tr></table></figure></p>
<p>这样，x = 1 的时候，计算 18 个表达式，可以得到<br>[0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0]，正好对应 r1cs 的 A B C的第一行。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">A</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">B</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">C</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>记 A(x) = s · (A1,A2,A3,A4,A5,A6)</p>
<p>A(x) <em> B(x) - C(x)  = s·a </em> s·b - s·c</p>
<p>同理， x = 1， 2， 3， 4 时，对应R1CS的4个约束， A(x) <em> B(x) - C(x)  = s·a </em> s·b - s·c = 0<br>所以  A(x) <em> B(x) - C(x) = 0 至少有 4 个解, 1, 2, 3, 4。<br>所以 A(x) </em> B(x) - C(x) 可以表示为 (x - 1)(x - 2)(x - 3)(x - 4) <em> H(x)<br>所以 A(x) </em> B(x) - C(x) 如果能够整除  (x - 1)(x - 2)(x - 3)(x - 4)，就可以认为满足所有约束</p>
<p>验证： 带入解向量 s = (1,3,35,9,27,30)，求得<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">A</span>(x) = s · (A1,A2,A3,A4,A5,A6)</span><br><span class="line">     = (<span class="number">1</span>,<span class="number">3</span>,<span class="number">35</span>,<span class="number">9</span>,<span class="number">27</span>,<span class="number">30</span>) ·（</span><br><span class="line">[-<span class="number">5.0</span>, <span class="number">9.166</span>, -<span class="number">5.0</span>, <span class="number">0.833</span>]</span><br><span class="line">[<span class="number">8.0</span>, -<span class="number">11.333</span>, <span class="number">5.0</span>, -<span class="number">0.666</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[-<span class="number">6.0</span>, <span class="number">9.5</span>, -<span class="number">4.0</span>, <span class="number">0.5</span>]</span><br><span class="line">[<span class="number">4.0</span>, -<span class="number">7.0</span>, <span class="number">3.5</span>, -<span class="number">0.5</span>]</span><br><span class="line">[-<span class="number">1.0</span>, <span class="number">1.833</span>, -<span class="number">1.0</span>, <span class="number">0.166</span>]）</span><br><span class="line">= [<span class="number">43.0</span>, -<span class="number">73.333</span>, <span class="number">38.5</span>, -<span class="number">5.166</span>]  </span><br><span class="line">（第一个系数<span class="number">43</span> = <span class="number">1</span> * （-<span class="number">5</span>） + <span class="number">3</span> * <span class="number">8</span> - <span class="number">6</span> * <span class="number">9</span> + <span class="number">4</span> * <span class="number">27</span> - <span class="number">30</span>）</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>同样<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s . B  = [-<span class="number">3.0</span>, <span class="number">10.333</span>, -<span class="number">5.0</span>, <span class="number">0.666</span>]</span><br><span class="line">s . C  = [-<span class="number">41.0</span>, <span class="number">71.666</span>, -<span class="number">24.5</span>, <span class="number">2.833</span>]</span><br></pre></td></tr></table></figure></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 顺序写反了？43应该是1的系数？</span></span><br><span class="line"><span class="title function_ invoke__">A</span>(x) * <span class="title function_ invoke__">B</span>(x) - <span class="title function_ invoke__">C</span>(x) = </span><br><span class="line">(<span class="number">43</span> * x^<span class="number">3</span> - <span class="number">73.333</span> * x^<span class="number">2</span> + <span class="number">38.5</span> * x - <span class="number">5.166</span>) *</span><br><span class="line">(-<span class="number">3</span> * x^<span class="number">3</span> + <span class="number">10.333</span> * x^<span class="number">2</span> - <span class="number">5</span> * x + <span class="number">0.666</span>) -</span><br><span class="line">(-<span class="number">41</span> * x^<span class="number">3</span> - <span class="number">71.666</span> * x^<span class="number">2</span> - <span class="number">24.5</span> * x + <span class="number">2.833</span>) </span><br><span class="line">= -<span class="number">88</span> * x^<span class="number">6</span> + <span class="number">592.666</span> * x^<span class="number">5</span> - <span class="number">1063.777</span> * x^<span class="number">4</span> + <span class="number">805</span> * x^<span class="number">3</span> </span><br><span class="line">- <span class="number">294.777</span> * x^<span class="number">2</span> + <span class="number">51.5</span> * x -<span class="number">3.444</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(x - <span class="number">1</span>)(x - <span class="number">2</span>)(x - <span class="number">3</span>)(x - <span class="number">4</span>)</span><br><span class="line">= <span class="number">24</span> * x^<span class="number">4</span> - <span class="number">50</span> * x^<span class="number">3</span> + <span class="number">35</span> * x^<span class="number">2</span> - <span class="number">10</span> * x + <span class="number">1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">A</span>(x) * <span class="title function_ invoke__">B</span>(x) - <span class="title function_ invoke__">C</span>(x)  / (x - <span class="number">1</span>)(x - <span class="number">2</span>)(x - <span class="number">3</span>)(x - <span class="number">4</span>)</span><br><span class="line">= - <span class="number">3.666</span> * x^<span class="number">2</span> - <span class="number">17.055</span> * x - <span class="number">3.444</span></span><br></pre></td></tr></table></figure>
<p>能够整除，认为 解 s 满足所有约束</p>
<p>相较于 R1CS，这部分用 R1CS 求出了多项式（系数）<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">A polynomials</span><br><span class="line">[-<span class="number">5.0</span>, <span class="number">9.166</span>, -<span class="number">5.0</span>, <span class="number">0.833</span>]</span><br><span class="line">[<span class="number">8.0</span>, -<span class="number">11.333</span>, <span class="number">5.0</span>, -<span class="number">0.666</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[-<span class="number">6.0</span>, <span class="number">9.5</span>, -<span class="number">4.0</span>, <span class="number">0.5</span>]</span><br><span class="line">[<span class="number">4.0</span>, -<span class="number">7.0</span>, <span class="number">3.5</span>, -<span class="number">0.5</span>]</span><br><span class="line">[-<span class="number">1.0</span>, <span class="number">1.833</span>, -<span class="number">1.0</span>, <span class="number">0.166</span>]</span><br><span class="line"></span><br><span class="line">B polynomials</span><br><span class="line">[<span class="number">3.0</span>, -<span class="number">5.166</span>, <span class="number">2.5</span>, -<span class="number">0.333</span>]</span><br><span class="line">[-<span class="number">2.0</span>, <span class="number">5.166</span>, -<span class="number">2.5</span>, <span class="number">0.333</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line"></span><br><span class="line">C polynomials</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line">[-<span class="number">1.0</span>, <span class="number">1.833</span>, -<span class="number">1.0</span>, <span class="number">0.166</span>]</span><br><span class="line">[<span class="number">4.0</span>, -<span class="number">4.333</span>, <span class="number">1.5</span>, -<span class="number">0.166</span>]</span><br><span class="line">[-<span class="number">6.0</span>, <span class="number">9.5</span>, -<span class="number">4.0</span>, <span class="number">0.5</span>]</span><br><span class="line">[<span class="number">4.0</span>, -<span class="number">7.0</span>, <span class="number">3.5</span>, -<span class="number">0.5</span>]</span><br></pre></td></tr></table></figure></p>
<p>对于任意的解向量 s，计算 s · (A1,A2,A3,A4,A5,A6) × s · (B1,B2,B3,B4,B5,B6) - s · (C1,C2,C3,C4,C5,C6) 能否整除 (x - 1)(x - 2)(x - 3)(x - 4)</p>
<h1 id="椭圆曲线"><a href="#椭圆曲线" class="headerlink" title="椭圆曲线"></a>椭圆曲线</h1><h2 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h2><p><img src="/2023/05/31/zk-SNARK%E5%AD%A6%E4%B9%A0/椭圆曲线.png" alt="image.png"><br>其中不等式保证曲线不包含奇点（保证椭圆上任意一点都有切线）<br>椭圆曲线关于 x 轴对称</p>
<h2 id="椭圆曲线运算规则"><a href="#椭圆曲线运算规则" class="headerlink" title="椭圆曲线运算规则"></a>椭圆曲线运算规则</h2><h3 id="加法：A-B"><a href="#加法：A-B" class="headerlink" title="加法：A + B"></a>加法：A + B</h3><p><img src="/2023/05/31/zk-SNARK%E5%AD%A6%E4%B9%A0/椭圆曲线加法.png" alt="image.png"><br>A B 是椭圆曲线上点，椭圆曲线上A + B的定义为：AB和椭圆曲线的交点关于X轴的对称点</p>
<h3 id="乘法：-2A-A-A"><a href="#乘法：-2A-A-A" class="headerlink" title="乘法： 2A = A + A"></a>乘法： 2A = A + A</h3><p><img src="/2023/05/31/zk-SNARK%E5%AD%A6%E4%B9%A0/椭圆曲线乘法.png" alt="image.png"></p>
<p>A  是椭圆曲线上点，椭圆曲线上 2A (A + A)的定义为：A点的切线和椭圆曲线的交点关于X轴的对称点<br>3A = A + 2A</p>
<h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><p>离散对数问题：<br>椭圆曲线上两个点 P Q， k为整数<br>Q = kP<br>加密原理：<br>点P为基点(base point), k 为私钥， Q 为公钥<br>给定 P 和 k， 计算 Q 很容易，<br><img src="/2023/05/31/zk-SNARK%E5%AD%A6%E4%B9%A0/快速幂.png" alt="image.png"><br>但给定 P Q，求 k 非常困难</p>
<h3 id="指数知识假设"><a href="#指数知识假设" class="headerlink" title="指数知识假设"></a>指数知识假设</h3><p>在椭圆曲线上，给定一对点 (P,Q)，其中 Pk = Q ，然后在给定一个点 C ，你不可能得到一个点 R=Ck，除非你知道 C 是怎样由点 P “派生”出来的(比如你知道 C=nP 中的 n ，那么 Ck = nPk = nQ )。<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Pk = Q  </span><br><span class="line">C = nP </span><br><span class="line">Ck = R</span><br></pre></td></tr></table></figure></p>
<p>zk-SNARK 的安全性依赖于这个假设，尽管其还没有被证明等价于其他困难问题（如离散对数问题），但是大多数密码学家认为它足够坚固。</p>
<h1 id="zk-SNARK-证明"><a href="#zk-SNARK-证明" class="headerlink" title="zk - SNARK 证明"></a>zk - SNARK 证明</h1><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Pk = Q  </span><br><span class="line">C = nP </span><br><span class="line">Ck = R</span><br></pre></td></tr></table></figure>
<p>Pk = Q   k =  f(x) = 43 <em> x^3 - 73.333 </em> x^2 + 38.5 * x - 5.166 = k<br>给定PQ ，证明者无法算出 k</p>
<p>C = nP    n = s<br>Ck = nPk = n Q = s Q = R<br>给定 CR， 验已知k，可以验证 Ck = R<br>但根据 C = nP，无法计算 n，即解向量 s</p>
<p>椭圆曲线上任取一点 G, k_a，k_b，k_c， t<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">G * A_1(t), G * A_1(t) * k_a</span><br><span class="line">G * A_2(t), G * A_2(t) * k_a</span><br><span class="line">…</span><br><span class="line">G * B_1(t), G * B_1(t) * k_b</span><br><span class="line">G * B_2(t), G * B_2(t) * k_b</span><br><span class="line">…</span><br><span class="line">G * C_1(t), G * C_1(t) * k_c</span><br><span class="line">G * C_2(t), G * C_2(t) * k_c</span><br><span class="line">…</span><br></pre></td></tr></table></figure></p>
<p>根据指数知识假设，只有知道解向量 s，才能够求出<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">π_a = G * <span class="title function_ invoke__">A_1</span>(t) * s, π_a&#x27; = G * <span class="title function_ invoke__">A_1</span>(t) * k_a * s</span><br><span class="line">G * <span class="title function_ invoke__">A_2</span>(t) * s, G * <span class="title function_ invoke__">A_2</span>(t) * k_a * s</span><br><span class="line">…</span><br><span class="line">G * <span class="title function_ invoke__">B_1</span>(t) * s, G * <span class="title function_ invoke__">B_1</span>(t) * k_b * s</span><br><span class="line">G * <span class="title function_ invoke__">B_2</span>(t) * s, G * <span class="title function_ invoke__">B_2</span>(t) * k_b * s</span><br><span class="line">…</span><br><span class="line">G * <span class="title function_ invoke__">C_1</span>(t) * s, G * <span class="title function_ invoke__">C_1</span>(t) * k_c * s</span><br><span class="line">G * <span class="title function_ invoke__">C_2</span>(t) * s, G * <span class="title function_ invoke__">C_2</span>(t) * k_c * s</span><br></pre></td></tr></table></figure></p>
<h1 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h1><p>Quadratic Arithmetic Programs: from Zero to Hero： <a target="_blank" rel="noopener" href="https://medium.com/@VitalikButerin/quadratic-arithmetic-programs-from-zero-to-hero-f6d558cea649?ref=blog.anoma.net">https://medium.com/@VitalikButerin/quadratic-arithmetic-programs-from-zero-to-hero-f6d558cea649?ref=blog.anoma.net</a><br>ETH ZKP： <a target="_blank" rel="noopener" href="https://ethereum.org/zh/zero-knowledge-proofs/">https://ethereum.org/zh/zero-knowledge-proofs/</a><br>VampIR：<a target="_blank" rel="noopener" href="https://blog.anoma.net/a-vamp-irs-guide-to-arithmetic-circuits-and-perfectly-boiled-eggs/">https://blog.anoma.net/a-vamp-irs-guide-to-arithmetic-circuits-and-perfectly-boiled-eggs/</a><br>【ECC加密算法】| ECC加密原理详解| 椭圆曲线加密| 密码学| 信息安全： <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1v44y1b7Fd/?spm_id_from=333.337.search-card.all.click&amp;vd_source=3f6c0363de570541eace117866128565">https://www.bilibili.com/video/BV1v44y1b7Fd/?spm_id_from=333.337.search-card.all.click&amp;vd_source=3f6c0363de570541eace117866128565</a><br>公钥加密技术ECC椭圆曲线加密算法原理： <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1BY411M74G/?spm_id_from=333.337.search-card.all.click&amp;vd_source=3f6c0363de570541eace117866128565">https://www.bilibili.com/video/BV1BY411M74G/?spm_id_from=333.337.search-card.all.click&amp;vd_source=3f6c0363de570541eace117866128565</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.he1pa.com/2023/04/20/ChatGPT-fine-tuning%E5%8F%8A%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/56333845?s=400&u=600fd5f50de976970544a4066a750cd59623091b&v=4">
      <meta itemprop="name" content="He1Pa">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Write the code, Change the world">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/04/20/ChatGPT-fine-tuning%E5%8F%8A%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">ChatGPT fine tuning 及部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-04-20 17:30:06" itemprop="dateCreated datePublished" datetime="2023-04-20T17:30:06+08:00">2023-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-31 17:35:09" itemprop="dateModified" datetime="2023-05-31T17:35:09+08:00">2023-05-31</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/04/20/ChatGPT-fine-tuning%E5%8F%8A%E9%83%A8%E7%BD%B2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/04/20/ChatGPT-fine-tuning%E5%8F%8A%E9%83%A8%E7%BD%B2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Request"><a href="#Request" class="headerlink" title="Request:"></a>Request:</h1><ul>
<li>Git</li>
<li>Openai API Key</li>
<li>python 3</li>
</ul>
<h1 id="Fine-tuning"><a href="#Fine-tuning" class="headerlink" title="Fine tuning"></a>Fine tuning</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装 OpenAI CLI<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade openai</span><br></pre></td></tr></table></figure></p>
<p>在环境变量中设置<code>OPENAI_API_KEY</code><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export OPENAI_API_KEY=&quot;&lt;OPENAI_API_KEY&gt;&quot;</span><br></pre></td></tr></table></figure></p>
<h2 id="Prepare-training-data"><a href="#Prepare-training-data" class="headerlink" title="Prepare training data"></a>Prepare training data</h2><p>训练数据使用 jsonl 格式，每一行都是一个 json。其中包含 <code>prompt</code> 和 <code>completion</code>，即问题和对应的回答。</p>
<p>需要注意的是，对于基础模型，可能需要很多不同的 prompt(few-shot learning)，但对于 fine-tuning，训练数据通常是一个输入和多种输出。</p>
<p>训练一个关于 KCL 的AI，首先教它回复关于如何安装 KCL。</p>
<blockquote>
<p>以下训练数据由Chatgpt生成<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 请访问 https://kcl-lang.io/docs/next/user_docs/getting-started/install 以获取KCL安装指南。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 您可以从 https://kcl-lang.io/docs/next/user_docs/getting-started/install 下载KCL，并遵循安装指南来安装它。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 您可以在 https://kcl-lang.io/docs/next/user_docs/getting-started/install 下载KCL，其中包含有关如何安装和使用KCL的文档。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; KCL的安装指南可以在 https://kcl-lang.io/docs/next/user_docs/getting-started/install 找到。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 有关如何安装和配置KCL的信息可以在 https://kcl-lang.io/docs/next/user_docs/getting-started/install 中找到。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 您可以在 https://kcl-lang.io/docs/next/user_docs/getting-started/install 下载KCL并查看安装指南。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 有关如何安装KCL的详细信息可以在 https://kcl-lang.io/docs/next/user_docs/getting-started/install 找到。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 您可以在 https://kcl-lang.io/docs/next/user_docs/getting-started/install 下载KCL，并遵循安装指南来安装它。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 请查看 https://kcl-lang.io/docs/next/user_docs/getting-started/install 以获取有关如何安装和使用KCL的指南。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 您可以在 https://kcl-lang.io/docs/next/user_docs/getting-started/install 找到有关如何安装和配置KCL的文档。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 请访问 https://kcl-lang.io/docs/next/user_docs/getting-started/install 并下载KCL，然后遵循安装指南来安装它。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 您可以从 https://kcl-lang.io/docs/next/user_docs/getting-started/install 下载KCL，并遵循安装指南来安装它。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 有关如何安装KCL###的信息可以在 https://kcl-lang.io/docs/next/user_docs/getting-started/install 中找到。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 请访问 https://kcl-lang.io/docs/next/user_docs/getting-started/install 并按照指南安装KCL。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 请访问 https://kcl-lang.io/docs/next/user_docs/getting-started/install 并下载KCL，然后按照安装指南来安装它。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 请查看 https://kcl-lang.io/docs/next/user_docs/getting-started/install 并下载KCL，然后按照安装指南来安装它。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 请查看 https://kcl-lang.io/docs/next/user_docs/getting-started/install 并下载KCL，然后遵循安装指南来安装它。\nEND&quot;&#125;</span><br><span class="line">&#123;&quot;prompt&quot;: &quot;如何安装KCL###&quot;, &quot;completion&quot;: &quot; 您可以在 https://kcl-lang.io/docs/next/user_docs/getting-started/install 下载KCL，并遵循安装指南来安装它。\nEND&quot;&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="创建训练模型"><a href="#创建训练模型" class="headerlink" title="创建训练模型"></a>创建训练模型</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openai api fine_tunes.create -t &lt;TRAIN_FILE_ID_OR_PATH&gt; -m &lt;BASE_MODEL&gt;</span><br></pre></td></tr></table></figure>
<p>其中，TRAIN_FILE_ID_OR_PATH 为训练数据的文件路径，BASE_MODEL 为基础模型，可选值为 <code>ada</code>, <code>babbage</code>, <code>curie</code>, 或 <code>davinci</code>。每种模型有不同的能力和价格。</p>
<p>执行命令后，会提交训练任务，通常需要排队，等待OpenAI训练完成即可。</p>
<h2 id="使用模型"><a href="#使用模型" class="headerlink" title="使用模型"></a>使用模型</h2><p>查看自己已经训练好的模型:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openai api fine_tunes.list</span><br></pre></td></tr></table></figure></p>
<p>通过 OpenAI CLI使用模型<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openai api completions.create -m &lt;FINE_TUNED_MODEL&gt; -p &lt;YOUR_PROMPT&gt;</span><br></pre></td></tr></table></figure></p>
<p>其他使用方法（cURL, Python, Node.js 参考 <a target="_blank" rel="noopener" href="https://platform.openai.com/docs/guides/fine-tuning/use-a-fine-tuned-model">https://platform.openai.com/docs/guides/fine-tuning/use-a-fine-tuned-model</a> ）</p>
<h1 id="（伪）部署到网站"><a href="#（伪）部署到网站" class="headerlink" title="（伪）部署到网站"></a>（伪）部署到网站</h1><p>OpenAI CLI查询比较麻烦，考虑通过网页方式调用。这里选择白嫖Github Page。</p>
<h2 id="新建-github-仓库"><a href="#新建-github-仓库" class="headerlink" title="新建 github 仓库"></a>新建 github 仓库</h2><p>新建仓库为</p>
<h2 id="写一个前端"><a href="#写一个前端" class="headerlink" title="写一个前端"></a>写一个前端</h2><p>新建 index.html 并添加以下代码。并push到github。</p>
<blockquote>
<p>以下代码由 Chatgpt 生成<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;OpenAI API demo&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;OpenAI API demo&lt;/h1&gt;</span><br><span class="line">    &lt;label for=&quot;api_key&quot;&gt;API Key:&lt;/label&gt;</span><br><span class="line">	  &lt;input type=&quot;text&quot; id=&quot;api_key&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;label for=&quot;model&quot;&gt;Model:&lt;/label&gt;</span><br><span class="line">	  &lt;input type=&quot;text&quot; id=&quot;model&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;label for=&quot;input&quot;&gt;Enter text:&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;input&quot; /&gt;</span><br><span class="line">    &lt;button onclick=&quot;submit()&quot;&gt;Submit&lt;/button&gt;</span><br><span class="line">    &lt;div id=&quot;output&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line">      async function submit() &#123;</span><br><span class="line">        const apiKey = document.getElementById(&quot;api_key&quot;).value;</span><br><span class="line">        const model = document.getElementById(&quot;model&quot;).value;</span><br><span class="line">        const input = document.getElementById(&quot;input&quot;).value;</span><br><span class="line"></span><br><span class="line">        const response = await fetch(</span><br><span class="line">          &quot;https://api.openai.com/v1/completions&quot;,</span><br><span class="line">          &#123;</span><br><span class="line">            method: &quot;POST&quot;,</span><br><span class="line">            headers: &#123;</span><br><span class="line">              &quot;Content-Type&quot;: &quot;application/json&quot;,</span><br><span class="line">              Authorization: &quot;Bearer &quot; + apiKey,</span><br><span class="line">            &#125;,</span><br><span class="line">            body: JSON.stringify(&#123;</span><br><span class="line">              prompt: input,</span><br><span class="line">              max_tokens: 200,</span><br><span class="line">              model: model,</span><br><span class="line">            &#125;),</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        const json = await response.json();</span><br><span class="line">        const output = json.choices[0].text.trim();</span><br><span class="line">        document.getElementById(&quot;output&quot;).innerHTML = output;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>注意：</p>
<ol>
<li>Key 不能直接写在代码中，OpenAI 会认为 Key 泄露并且让 Key 失效。</li>
<li>模型可以写在代码中，但是考虑到模型迭代，测试阶段可以在前端直接输入模型名，方便测试。</li>
</ol>
<h2 id="设置-Github-Page"><a href="#设置-Github-Page" class="headerlink" title="设置 Github Page"></a>设置 Github Page</h2><p>Github repo -&gt; Settings -&gt; Pages -&gt; Build and deployment -&gt; Source -&gt; Deploy from branch</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p><a target="_blank" rel="noopener" href="https://platform.openai.com/docs/api-reference/fine-tunes">https://platform.openai.com/docs/api-reference/fine-tunes</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.he1pa.com/2023/04/10/ChatGPT's-Impact-on-Programming-Languages-A-Look-into-the-Future/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/56333845?s=400&u=600fd5f50de976970544a4066a750cd59623091b&v=4">
      <meta itemprop="name" content="He1Pa">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Write the code, Change the world">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/04/10/ChatGPT's-Impact-on-Programming-Languages-A-Look-into-the-Future/" class="post-title-link" itemprop="url">ChatGPT's Impact on Programming Languages: A Look into the Future</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-04-10 21:58:22 / Modified: 22:38:55" itemprop="dateCreated datePublished" datetime="2023-04-10T21:58:22+08:00">2023-04-10</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/04/10/ChatGPT's-Impact-on-Programming-Languages-A-Look-into-the-Future/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/04/10/ChatGPT's-Impact-on-Programming-Languages-A-Look-into-the-Future/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>ChatGPT is a natural language processing model developed by OpenAI that can generate human-like responses to text input. It has been used in various applications, such as chatbots, question-answering systems, and language translation tools.<br>Importance of programming languages and programmers: Programming languages are the backbone of software development, and programmers are the ones who use these languages to create software applications that power many aspects of our lives. As technology continues to advance and become more integrated into our daily routines, the demand for programming skills and expertise is increasing rapidly.<br>This section sets the stage for the discussion of how ChatGPT might impact programming languages and programmers. It establishes the relevance of these topics and highlights the significance of ChatGPT as a potential game-changer in the field of computer science.</p>
<h1 id="Impact-on-programming-languages"><a href="#Impact-on-programming-languages" class="headerlink" title="Impact on programming languages"></a>Impact on programming languages</h1><h2 id="ChatGPT’s-natural-language-processing-abilities"><a href="#ChatGPT’s-natural-language-processing-abilities" class="headerlink" title="ChatGPT’s natural language processing abilities"></a>ChatGPT’s natural language processing abilities</h2><p>ChatGPT is a state-of-the-art natural language processing model developed by OpenAI. It is a machine learning system that uses deep learning techniques to analyze and understand human language. ChatGPT is based on a transformer architecture, which enables it to process and generate natural language text at a large scale. It has been trained on vast amounts of text data and has learned to predict the most likely next word or sentence given a specific prompt.</p>
<p>One of the most impressive features of ChatGPT is its ability to generate human-like responses to text input. This means that it can hold a conversation with a user and respond in a way that is both understandable and natural-sounding. ChatGPT can also perform a variety of other natural language processing tasks, such as language translation, text summarization, and sentiment analysis.</p>
<p>ChatGPT’s natural language processing abilities have significant implications for the field of computer science. It has the potential to revolutionize the way we interact with computers and other devices, making it easier and more intuitive for users to communicate with machines. ChatGPT could also be used to power chatbots and other conversational interfaces, enabling businesses to provide better customer service and support. Ultimately, ChatGPT’s natural language processing abilities are likely to play a significant role in shaping the future of computing and artificial intelligence.</p>
<h2 id="Potential-for-easier-programming"><a href="#Potential-for-easier-programming" class="headerlink" title="Potential for easier programming"></a>Potential for easier programming</h2><p>Rust is known for its complex features like lifetime and ownership, which can be difficult to understand for many programmers, especially beginners. However, with the help of ChatGPT, developers can ask questions about these complex features in natural language and get easy-to-understand explanations.</p>
<p>For example, a developer who is struggling to understand Rust’s lifetime and ownership rules can ask the ChatGPT Rust chatbot, “What are Rust’s lifetime and ownership rules?” The chatbot can respond with a natural language explanation, such as “In Rust, every value has an owner and a lifetime. The owner is responsible for deallocating the value when it’s no longer needed, and the lifetime determines how long the value can be used.”</p>
<p>The Rust chatbot can also give more specific explanations of Rust’s lifetime and ownership rules based on the developer’s specific questions. For instance, a developer might ask, “How do I move a value between ownership?” The chatbot can respond with a natural language explanation, such as “In Rust, you can move a value from one owner to another by using the ‘move’ keyword. This transfers ownership of the value to the new owner, and the old owner can no longer access the value.”</p>
<p>With the help of ChatGPT, developers can get easy-to-understand explanations of Rust’s complex features, regardless of their level of experience. This can help to make Rust programming more accessible to a wider range of developers, and can also help to improve communication and collaboration between developers who have different levels of experience with the language.</p>
<p>In conclusion, ChatGPT has the potential to make programming easier by allowing developers to ask questions and receive explanations in natural language, rather than having to learn the specific syntax and structure of a programming language. With the help of ChatGPT, developers can more easily understand complex features like Rust’s lifetime and ownership rules, which can help to make Rust programming more accessible and collaborative for developers of all levels.</p>
<h2 id="Possibility-of-creating-new-programming-languages"><a href="#Possibility-of-creating-new-programming-languages" class="headerlink" title="Possibility of creating new programming languages"></a>Possibility of creating new programming languages</h2><p>One of the exciting possibilities that arises with the development of language models like GPT is the potential for creating new programming languages. Language models have the ability to learn and generate natural language, which means they could be programmed to understand and generate code in new programming languages.</p>
<p>This opens up a world of possibilities for creating programming languages that are optimized for specific tasks or domains. For example, a programming language could be designed specifically for machine learning or data analysis, with syntax and features tailored to those tasks. Alternatively, a new programming language could be developed for use in areas like robotics, finance, or healthcare, with features optimized for those domains.</p>
<p>The potential benefits of creating new programming languages are many. A language tailored for a specific domain could make it easier for programmers to develop applications in that field. It could also make it easier to optimize code for specific hardware or software platforms. Additionally, a new programming language could provide a more intuitive or efficient way to program, leading to faster development and better performance.</p>
<p>Of course, creating a new programming language is a complex task that involves more than just generating code. It requires careful consideration of the syntax and structure of the language, as well as its features and capabilities. It also involves testing and refinement to ensure the language is reliable and efficient.</p>
<p>However, with the help of language models like GPT, the process of creating a new programming language could be accelerated. Developers could use GPT to experiment with different syntaxes and features, and generate code for testing and refinement.</p>
<p>In conclusion, the possibility of creating new programming languages with the help of language models like GPT is an exciting development in the world of programming. By tailoring programming languages to specific domains or tasks, developers have the potential to create more efficient, intuitive, and powerful programming languages that improve the speed and quality of software development.</p>
<h1 id="Impact-on-programmers"><a href="#Impact-on-programmers" class="headerlink" title="Impact on programmers"></a>Impact on programmers</h1><h2 id="Potential-for-more-efficient-communication-and-collaboration"><a href="#Potential-for-more-efficient-communication-and-collaboration" class="headerlink" title="Potential for more efficient communication and collaboration"></a>Potential for more efficient communication and collaboration</h2><p>The development of language models like GPT also has the potential to improve communication and collaboration across various industries and domains. Natural language processing and generation technology can help to bridge language barriers and facilitate more efficient communication among people who speak different languages.</p>
<p>One area where this technology could be particularly useful is in the field of international business. With the help of language models, employees could more easily communicate with their international colleagues and clients, translating messages and documents in real-time. This could lead to more productive and efficient collaborations, as well as new business opportunities.</p>
<p>Moreover, language models could also facilitate collaboration among teams working on complex projects. For example, a team of software developers could use a language model to generate code snippets or provide suggestions for optimizations, reducing the time and resources required for manual coding and debugging. Additionally, language models could help team members communicate and collaborate more effectively by automatically generating summaries of team meetings or flagging areas where further clarification is needed.</p>
<p>Furthermore, language models could also enhance communication and collaboration in scientific research. In fields such as medicine and biology, researchers often work with large amounts of data and complex terminology. With the help of language models, researchers could more easily share and analyze data, generating new insights and discoveries.</p>
<p>In conclusion, the potential for more efficient communication and collaboration through the development of language models like GPT is significant. By bridging language barriers and enhancing communication among teams, these technologies could improve productivity, reduce costs, and open up new opportunities for collaboration across various industries and domains.</p>
<h2 id="Potential-for-automating-certain-programming-tasks"><a href="#Potential-for-automating-certain-programming-tasks" class="headerlink" title="Potential for automating certain programming tasks"></a>Potential for automating certain programming tasks</h2><p>The development of language models like GPT also has the potential to automate certain programming tasks, which could greatly improve the efficiency and productivity of software developers. Natural language processing and generation technology can help programmers to write code more quickly, accurately, and with fewer errors than traditional manual coding methods.</p>
<p>One area where this technology could be particularly useful is in the field of software development. With the help of language models, programmers could more easily generate code snippets, create templates, and automate repetitive coding tasks. For example, a language model could be trained on a large dataset of existing code and used to automatically generate new code based on specific inputs. This could help programmers to create new software programs more quickly and efficiently, reducing the time and resources required for manual coding and debugging.</p>
<p>Moreover, language models could also help to address the problem of code quality and consistency. By providing standardized code templates and automating certain coding tasks, language models could help to ensure that code is written in a consistent and error-free manner, reducing the risk of bugs and other issues in the final software product.</p>
<p>Furthermore, language models could also help to democratize programming by making it more accessible to non-technical users. With the help of language models, individuals without a background in programming could more easily generate code and develop their software applications, opening up new opportunities for innovation and entrepreneurship.</p>
<p>In conclusion, the potential for automating certain programming tasks through the development of language models like GPT is significant. By improving the speed, accuracy, and consistency of code generation, these technologies could greatly enhance the efficiency and productivity of software developers, as well as open up new opportunities for innovation and entrepreneurship in the field of software development.</p>
<h2 id="Potential-for-changing-the-nature-of-programming-jobs"><a href="#Potential-for-changing-the-nature-of-programming-jobs" class="headerlink" title="Potential for changing the nature of programming jobs"></a>Potential for changing the nature of programming jobs</h2><p>The development of language models like GPT has the potential to change the nature of programming jobs in several ways. One of the main impacts is likely to be on the skills required for programming jobs, as well as the tasks that programmers are responsible for. The introduction of language models could lead to the automation of certain aspects of programming, such as code generation and debugging. This could mean that programmers will need to develop new skills, such as the ability to work with language models and to understand the output that they generate.</p>
<p>Moreover, the use of language models could also lead to changes in the roles and responsibilities of programmers. With certain programming tasks becoming automated, programmers may be able to focus more on higher-level tasks such as designing software architecture, analyzing data, and developing algorithms. This could require programmers to develop new skills in areas such as machine learning and data analysis, in order to remain competitive in the field.</p>
<p>The use of language models could also lead to changes in the types of programming jobs that are available. Certain tasks, such as code generation and debugging, may be more easily automated than others, such as software design and project management. This could lead to a shift in the types of jobs that are available in the programming industry, with more emphasis on higher-level tasks and less on manual coding and debugging.</p>
<p>Finally, the use of language models could also have implications for the way that programming work is organized and distributed. With certain programming tasks becoming automated, it may be possible for programming work to be outsourced more easily, or for non-technical users to generate their own code using language models. This could lead to changes in the way that programming teams are structured, and in the way that programming work is managed and distributed.</p>
<p>In conclusion, the development of language models like GPT has the potential to change the nature of programming jobs in several ways, including the skills required, the tasks programmers are responsible for, the types of jobs available, and the way that programming work is organized and distributed. While the full extent of these changes is not yet clear, it is likely that language models will have a significant impact on the programming industry in the coming years.</p>
<h1 id="Challenges-and-concerns"><a href="#Challenges-and-concerns" class="headerlink" title="Challenges and concerns"></a>Challenges and concerns</h1><h2 id="Limitations-of-ChatGPT"><a href="#Limitations-of-ChatGPT" class="headerlink" title="Limitations of ChatGPT"></a>Limitations of ChatGPT</h2><p>While ChatGPT is a promising tool for generating human-like responses to text-based queries, it has several limitations that must be taken into account. Some of the most significant limitations of ChatGPT are:</p>
<ul>
<li><p>Lack of context: ChatGPT relies heavily on the text that is inputted into it, and may not take into account the broader context of the conversation or the user’s background. This can lead to responses that are not relevant or appear to miss the point of the conversation.</p>
</li>
<li><p>Inability to handle complex queries: While ChatGPT can generate responses to a wide range of queries, it may struggle with more complex or nuanced questions that require a deeper understanding of the topic. This can lead to responses that are incomplete, inaccurate, or not helpful.</p>
</li>
<li><p>Repetitive responses: ChatGPT may generate repetitive responses, especially when asked similar questions or when responding to queries that are related to a particular topic. This can lead to a lack of variety in the responses, which can be frustrating for users.</p>
</li>
<li><p>Limited language support: ChatGPT is primarily trained on English language text, which means that it may struggle with other languages or with users who use non-standard language or phrasing.</p>
</li>
<li><p>Lack of emotional intelligence: While ChatGPT can generate responses that are contextually relevant, it lacks emotional intelligence and may struggle to understand the tone or sentiment of a conversation. This can lead to responses that are insensitive or inappropriate.</p>
</li>
</ul>
<p>In conclusion, while ChatGPT is a promising tool for generating text-based responses, it has several limitations that must be taken into account. These limitations can impact the accuracy and relevance of the responses, and can impact the user experience for those using the tool. As with any AI tool, it is important to use ChatGPT in conjunction with other resources and to be aware of its limitations.</p>
<h2 id="Possible-impact-on-job-market"><a href="#Possible-impact-on-job-market" class="headerlink" title="Possible impact on job market"></a>Possible impact on job market</h2><p>The development of artificial intelligence (AI) and chatbots like ChatGPT has raised concerns about their potential impact on the job market. While some argue that AI and chatbots will create new job opportunities and enhance productivity, others fear that they will lead to significant job losses and displace workers in certain industries.</p>
<ul>
<li><p>Automation of jobs: AI and chatbots can perform repetitive and routine tasks much faster and more accurately than humans, which means that certain jobs may become automated. For example, customer service roles may be replaced by chatbots that can provide instant responses to customer queries. This could lead to job losses in these industries as businesses look to save costs by replacing human workers with chatbots.</p>
</li>
<li><p>Creation of new jobs: On the other hand, the development of AI and chatbots may also create new job opportunities in areas such as software development, data analysis, and machine learning. These new jobs may require a different set of skills and expertise than traditional jobs, which could lead to a shift in the job market and a need for retraining and reskilling of workers.</p>
</li>
<li><p>Changes in skill requirements: As AI and chatbots become more prevalent in the workplace, the skills required for certain jobs may change. Workers may need to develop skills in areas such as data analysis and programming to remain competitive in the job market. This could lead to a skills gap if workers are unable or unwilling to develop these new skills.</p>
</li>
<li><p>Impact on low-wage jobs: AI and chatbots may have a greater impact on low-wage jobs, as these roles are often more routine in nature and therefore more susceptible to automation. This could lead to income inequality as workers in low-wage jobs are displaced and struggle to find new employment opportunities.</p>
</li>
<li><p>Impact on industries: Certain industries may be more vulnerable to job losses as a result of AI and chatbots. For example, the transportation and logistics industries may be impacted by the development of autonomous vehicles, which could replace human drivers. Similarly, the manufacturing industry may see increased automation as a result of advances in AI and robotics.</p>
</li>
</ul>
<h2 id="Concerns-about-accuracy-and-bias-in-programming"><a href="#Concerns-about-accuracy-and-bias-in-programming" class="headerlink" title="Concerns about accuracy and bias in programming"></a>Concerns about accuracy and bias in programming</h2><p>The use of artificial intelligence (AI) and chatbots like ChatGPT has raised concerns about the accuracy and potential bias in programming. These concerns arise due to the fact that AI and chatbots are programmed by humans, who may unconsciously introduce their own biases and prejudices into the technology. This can have a significant impact on the accuracy and fairness of AI and chatbots, particularly in areas such as decision-making, where the consequences of bias can be severe.</p>
<ul>
<li><p>Bias in programming: One of the main concerns about AI and chatbots is that they may perpetuate and amplify biases that are present in society. This can happen in a number of ways, such as when programmers use biased datasets to train algorithms, or when they unconsciously introduce their own biases into the programming. For example, an AI algorithm used in hiring may be trained using data that is biased against certain groups, resulting in discrimination against those groups in the hiring process.</p>
</li>
<li><p>Lack of transparency: Another concern is the lack of transparency in AI and chatbot programming. In some cases, it may be difficult to understand how an AI or chatbot arrived at a particular decision or response, making it difficult to identify and correct biases. This can lead to mistrust and skepticism of AI and chatbots, particularly in areas where the consequences of bias can be severe, such as criminal justice and healthcare.</p>
</li>
<li><p>Quality of data: The accuracy of AI and chatbots is also dependent on the quality of data used to train the algorithms. If the data is inaccurate or incomplete, the algorithms may produce inaccurate or biased results. This can be particularly problematic in areas where data is scarce or difficult to collect, such as in developing countries or in marginalized communities.</p>
</li>
<li><p>Ethical considerations: The use of AI and chatbots also raises ethical considerations, particularly in areas such as privacy and surveillance. For example, if chatbots are used to collect personal data from users, there is a risk that this data could be misused or shared without the user’s consent. Similarly, algorithms used in decision-making may have a disproportionate impact on certain groups, raising questions about fairness and justice.</p>
</li>
</ul>
<p>In conclusion, while the use of AI and chatbots like ChatGPT has the potential to revolutionize many aspects of our lives, it also raises important concerns about accuracy and bias in programming. Businesses and policymakers will need to take steps to ensure that AI and chatbots are programmed in a way that is fair, transparent, and ethical, and that they do not perpetuate or amplify biases in society. This will require ongoing monitoring and evaluation of the technology, as well as a commitment to diversity and inclusion in programming teams.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>In conclusion, ChatGPT has the potential to significantly impact programming languages and programmers. The natural language processing abilities of ChatGPT could make programming easier and more accessible for those without extensive programming knowledge. Additionally, it could potentially lead to the creation of new programming languages. For programmers, ChatGPT could make communication and collaboration more efficient, as well as automate certain programming tasks. However, there are also concerns about the limitations of ChatGPT, its impact on the job market, and accuracy and bias in programming. It is important to continue exploring and monitoring the impact of ChatGPT on programming, while also addressing these concerns through ethical programming practices. Ultimately, the successful integration of ChatGPT into programming will require a balanced approach that considers both the potential benefits and drawbacks.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.he1pa.com/2023/02/08/ETH%E8%B4%A8%E6%8A%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/56333845?s=400&u=600fd5f50de976970544a4066a750cd59623091b&v=4">
      <meta itemprop="name" content="He1Pa">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Write the code, Change the world">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/08/ETH%E8%B4%A8%E6%8A%BC/" class="post-title-link" itemprop="url">ETH质押</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-02-08 00:17:23 / Modified: 00:46:46" itemprop="dateCreated datePublished" datetime="2023-02-08T00:17:23+08:00">2023-02-08</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/02/08/ETH%E8%B4%A8%E6%8A%BC/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/02/08/ETH%E8%B4%A8%E6%8A%BC/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="以太坊测试网首次成功模拟-ETH-质押提款"><a href="#以太坊测试网首次成功模拟-ETH-质押提款" class="headerlink" title="以太坊测试网首次成功模拟 ETH 质押提款"></a>以太坊测试网首次成功模拟 ETH 质押提款</h2><p>2 月 7 日，以太坊 zhejiang 测试网络在 UTC 时间 15:00（北京时间 23:00 ）epoch 1350 上激活上海升级，首次成功模拟了质押 ETH 的提款。在 zhejiang 测试网上，部分和全部提款已经 BLS 更改都包含在执行负载中，下一次测试网升级将在下周的某个时间在 Sepolia 进行，随后是是 Goerli 测试网。</p>
<h3 id="权益证明与质押"><a href="#权益证明与质押" class="headerlink" title="权益证明与质押"></a>权益证明与质押</h3><h3 id="ETH-合并"><a href="#ETH-合并" class="headerlink" title="ETH 合并"></a>ETH 合并</h3><p>合并是指以太坊的原有执行层（从创世块开始就一直存在的主网）加入其新的权益证明共识层，即信标链。 合并摒弃了消耗大量能源的挖矿，而是通过质押以太币来保护网络的安全。</p>
<p>信标链于 2020 年 12 月 1 日创建，它作为独立的区块链与主网一起运行。并于于 2022 年 9 月 15 日执行合并， 它完成了以太坊向权益证明共识的过渡，以太坊正式弃用了工作量证明并将能源消耗减少了约 99.95%。</p>
<h3 id="什么是权益证明？"><a href="#什么是权益证明？" class="headerlink" title="什么是权益证明？"></a>什么是权益证明？</h3><p>权益证明是一类算法，它可以通过确保有价值的资产被不诚实行为的攻击者丢失来为区块链提供安全性。 股权证明系统需要一组验证者来提供一些资产，如果验证者从事某些可证明的不诚实行为，这些资产可能会被销毁。 以太坊使用权益证明机制来保护区块链。</p>
<h2 id="什么是质押？"><a href="#什么是质押？" class="headerlink" title="什么是质押？"></a>什么是质押？</h2><p>质押是指存入 32 个以太币以激活验证者软件的行为。作为验证者，你将负责存储数据、处理交易以及向区块链添加新区块。这将每个人保证以太坊的安全，并在此过程中为你赚取新的以太币。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.he1pa.com/2023/02/03/%E3%80%90%E8%AF%91%E3%80%91%E4%BB%80%E4%B9%88%E6%98%AF%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/56333845?s=400&u=600fd5f50de976970544a4066a750cd59623091b&v=4">
      <meta itemprop="name" content="He1Pa">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Write the code, Change the world">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/03/%E3%80%90%E8%AF%91%E3%80%91%E4%BB%80%E4%B9%88%E6%98%AF%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%EF%BC%9F/" class="post-title-link" itemprop="url">【译】什么是零知识证明？</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-02-03 17:20:20" itemprop="dateCreated datePublished" datetime="2023-02-03T17:20:20+08:00">2023-02-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-02-06 23:03:51" itemprop="dateModified" datetime="2023-02-06T23:03:51+08:00">2023-02-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web3/" itemprop="url" rel="index"><span itemprop="name">Web3</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/02/03/%E3%80%90%E8%AF%91%E3%80%91%E4%BB%80%E4%B9%88%E6%98%AF%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%EF%BC%9F/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/02/03/%E3%80%90%E8%AF%91%E3%80%91%E4%BB%80%E4%B9%88%E6%98%AF%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%EF%BC%9F/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>原文链接: <a target="_blank" rel="noopener" href="https://ethereum.org/zh/zero-knowledge-proofs/">https://ethereum.org/zh/zero-knowledge-proofs/</a></p>
</blockquote>
<h2 id="什么是零知识证证明-Zero-Knowledge-Proofs-ZKP-？"><a href="#什么是零知识证证明-Zero-Knowledge-Proofs-ZKP-？" class="headerlink" title="什么是零知识证证明(Zero-Knowledge Proofs, ZKP)？"></a>什么是零知识证证明(Zero-Knowledge Proofs, ZKP)？</h2><p>零知识证明是一种无需揭示声明本身即可证明其有效性的方法。“证明者”(prover)是试图证明主张的一方，而“验证者”则负责验证主张。</p>
<p>零知识证明最早出现在1985年的一篇论文《交互证明系统的知识复杂性》中，该论文提供了当今普遍使用的零知识证明的定义：</p>
<blockquote>
<p>零知识协议是一种方法，其中一方（证明者）可以向另一方（验证者）证明某事是真实的，同时不暴露除了该特定声明为真实之外的任何信息。</p>
</blockquote>
<p>零知识证明已经在近几年得到了改进，现在它们正被用于几个现实世界的应用中。</p>
<h2 id="我们为什么需要零知识证明？"><a href="#我们为什么需要零知识证明？" class="headerlink" title="我们为什么需要零知识证明？"></a>我们为什么需要零知识证明？</h2><p>零知识证明代表了应用密码学的一个突破，它承诺可以提高个人信息的安全性。考虑一下你如何向另一方（如服务提供商）证明一个主张（例如“我是X国公民”）。您需要提供“证据”以支持您的主张，例如国家护照或驾驶执照。</p>
<p>但是，这种方法存在问题，主要是缺乏隐私性。与第三方服务共享的个人识别信息（Personally Identifiable Information, PII）存储在中央数据库中，易受到黑客攻击。由于身份盗窃已成为一个严重问题，有人呼吁采取更具有隐私保护性的共享敏感信息的方法。</p>
<p>零知识证明通过消除证明声明有效性所需要的信息披露可以解决此问题。零知识协议将语句（称为“见证”）作为输入，生成其有效性的简洁证明。该证明提供了强有力的保证，即声明为真，而不暴露创建它所使用的信息。</p>
<p>回到我们之前的示例，您证明公民身份的唯一证据就是零知识证明。验证者只需检查证明的某些属性是否为真，以确信基础声明也为真。</p>
<h2 id="零知识证明是如何运作的？"><a href="#零知识证明是如何运作的？" class="headerlink" title="零知识证明是如何运作的？"></a>零知识证明是如何运作的？</h2><p>零知识证明允许您在不共享陈述内容或揭示您如何发现真相的情况下，证明陈述的真实性。为了使此可能，零知识协议依赖于将一些数据作为输入并返回“真”或“假”的算法。</p>
<p>零知识协议必须满足以下标准：</p>
<ol>
<li><p>完备性(Completeness)：如果输入有效，零知识协议始终返回“真”。因此，如果潜在的陈述是真实的，并且证明人和验证者表现诚实，则可以接受证明。</p>
</li>
<li><p>可靠性(Soundness)：如果输入无效，从理论上讲，不可能欺骗零知识协议返回“真”。因此，撒谎者不能诱使诚实的验证者相信无效声明是有效的（除了很小的概率）。</p>
</li>
<li><p>零知识：验证者除了了解声明的有效性或虚假性以外，不了解任何其他信息（他们对声明“零知识”）。这个要求还阻止验证者从证明中推导出原始输入（陈述的内容）。</p>
</li>
</ol>
<p>基本上，零知识证明由三个要素组成 witness、challenge 和 response。</p>
<ul>
<li><p>Witness: 在零知识证明中，证明者想要证明某一隐藏信息。这个秘密信息就是证明的“witness”，并且证明者假定：基于对witness的某些了解，能确保解一组问题，这些问题只能由了解信息的一方回答。因此，证明者开始证明流程，通过随机选择一个问题，计算回答，并将其发送给验证者。</p>
</li>
<li><p>Challenge: 验证者从该系列中随机挑选另外一个问题，并要求证明回答。</p>
</li>
<li><p>Response: 证明者接受该问题，计算答案，并将其返回给验证者。证明者的回应允许验证者检查前者是否真的了解 Witness。为了确保凭证者不是在盲目猜测而得到正确答案，验证者会选择更多的问题来问。通过重复这种互动很多次，证明者伪装了解 witness 的可能性显著降低，直到验证者满意为止。</p>
</li>
</ul>
<p>上述描述的是“交互式零知识证明”的结构。早期的零知识协议使用交互式证明，验证一个陈述的有效性需要证明者和验证者之间的来回通信。</p>
<p>一个很好的例子可以说明交互式证明如何运作，就是Jean-Jacques Quisquater的著名的阿里巴巴洞穴故事。在故事中，佩姬（证明者）想要向维克托（验证者）证明她知道开启魔法门的秘密短语，但又不把这个短语暴露出来。</p>
<h3 id="非交互式零知识证明"><a href="#非交互式零知识证明" class="headerlink" title="非交互式零知识证明"></a>非交互式零知识证明</h3><p>虽然具有革命性，但交互式证明的用处有限，因为它需要两方随时可用并反复交互。 即使验证者确信证明者是诚实的，该证明也无法用于独立验证（计算新证明需要证明者和验证者之间的一组新消息）。</p>
<p>为了解决这个问题，Manuel Blum、Paul Feldman 和 Silvio Micali 提出了第一个非交互式零知识证明，其中证明者和验证者拥有共享密钥。 这允许证明者在不提供信息本身的情况下证明他们对某些信息的了解（即 witness）。</p>
<p>与交互式证明不同，非交互式证明只需要参与者（证明者和验证者）之间进行一轮通信。 证明者将秘密信息传递给特殊算法以计算零知识证明。 该证明被发送给验证者，验证者使用另一种算法检查证明者是否知道秘密信息。</p>
<p>非交互式证明减少了证明者和验证者之间的通信，使零知识证明更加高效。 此外，一旦生成了证明，其他任何人（可以访问共享密钥和验证算法）都可以进行验证。</p>
<p>非交互式证明代表了零知识技术的突破，并推动了当今使用的证明系统的发展。 我们在下面讨论这些证明类型：</p>
<h3 id="零知识证明的类型"><a href="#零知识证明的类型" class="headerlink" title="零知识证明的类型"></a>零知识证明的类型</h3><h4 id="ZK-SNARKs"><a href="#ZK-SNARKs" class="headerlink" title="ZK-SNARKs"></a>ZK-SNARKs</h4><p>ZK-SNARK 是 Zero-Knowledge Succinct Non-Interactive Argument of Knowledge 的缩写。 ZK-SNARK 协议具有以下特点：</p>
<ul>
<li><p>Zero-Knowledge: 验证者可以在不知道语句的任何其他信息的情况下验证语句的完整性。 验证者对声明的唯一了解是它是真还是假。</p>
</li>
<li><p>Succinct: 零知识证明比witness小，可以快速验证。</p>
</li>
<li><p>Non-Interactive: 证明是“非交互式”的，因为证明者和验证者只交互一次，不像交互式证明需要多轮通信。</p>
</li>
</ul>
<p>Argument: 证明满足“可靠性”要求，因此作弊的可能性极小。</p>
<p>(Of) Knowledge：如果不访问秘密信息（witness），则无法构建零知识证明。 对于没有见证人的证明者来说，即使不是不可能，也很难计算出有效的零知识证明。</p>
<p>前面提到的“共享密钥”是指证明者和验证者同意在生成和验证证明时使用的公共参数。 生成公共参数（统称为公共参考字符串 (CRS)）是一项敏感操作，因为它对协议的安全性很重要。 如果用于生成 CRS 的熵（随机性）落入不诚实的证明者手中，他们就可以计算出错误证明。</p>
<p>多方计算（MPC）是一种降低生成公共参数风险的方法。 多方参与可信设置仪式(Trust Setup Ceremonies)，其中每个人贡献一些随机值来生成 CRS。 只要一个诚实的一方破坏了他们的那部分熵，ZK-SNARK 协议就会保持计算稳健性。</p>
<p>可信设置要求用户信任参数生成的参与者。 然而，ZK-STARKs 的开发使得证明协议能够在不受信任的设置下工作。</p>
<h4 id="ZK-STARKs"><a href="#ZK-STARKs" class="headerlink" title="ZK-STARKs"></a>ZK-STARKs</h4><p>ZK-STARK 是 Zero-Knowledge Scalable Transparent Argument of Knowledge 的缩写。 ZK-STARKs 类似于 ZK-SNARKs，除了：</p>
<ul>
<li><p>Scalable: 当见证规模较大时，ZK-STARK 在生成和验证证明方面比 ZK-SNARK 更快。 使用 STARK 证明，证明者和验证者的时间只会随着见证的增长而略有增加（SNARK 证明者和验证者的时间随着见证者的规模线性增加）。</p>
</li>
<li><p>Transparent: ZK-STARK 依靠可公开验证的随机性来生成用于证明和验证的公共参数，而不是可信设置。 因此，与 ZK-SNARK 相比，它们更加透明。</p>
</li>
</ul>
<p>ZK-STARKs 产生比 ZK-SNARKs 更大的证明，这意味着它们通常具有更高的验证开销。 但是，在某些情况下（例如证明大型数据集），ZK-STARK 可能比 ZK-SNARK 更具成本效益。</p>
<h2 id="零知识证明的用例"><a href="#零知识证明的用例" class="headerlink" title="零知识证明的用例"></a>零知识证明的用例</h2><h3 id="匿名支付"><a href="#匿名支付" class="headerlink" title="匿名支付"></a>匿名支付</h3><p>信用卡支付通常对多方可见，包括支付提供商、银行和其他相关方（例如政府机构）。 虽然金融监督有利于识别非法活动，但它也损害了普通公民的隐私。</p>
<p>加密货币旨在为用户提供一种进行私人、点对点交易的方式。 但大多数加密货币交易在公共区块链上都是公开可见的。 用户身份通常是假名的，并且要么故意链接到真实世界的身份（例如，通过在 Twitter 或 GitHub 个人资料中包含 ETH 地址），要么可以使用基本的链上和链下数据分析与真实世界的身份相关联。</p>
<p>有专为完全匿名交易而设计的特定“隐私币”。 Zcash 和 Monero 等注重隐私的区块链会屏蔽交易细节，包括发送方/接收方地址、资产类型、数量和交易时间表。</p>
<p>通过将零知识技术融入协议，以隐私为中心的区块链网络允许节点在无需访问交易数据的情况下验证交易。</p>
<p>零知识证明也被应用于公共区块链上的匿名交易。 一个例子是 Tornado Cash，这是一种去中心化的非托管服务，允许用户在以太坊上进行私人交易。 Tornado Cash 使用零知识证明来混淆交易细节并保证财务隐私。 不幸的是，因为这些是“选择加入”的隐私工具，所以它们与非法活动有关。 为了克服这个问题，隐私最终必须成为公共区块链的默认设置。</p>
<h3 id="身份保护"><a href="#身份保护" class="headerlink" title="身份保护"></a>身份保护</h3><p>当前的身份管理系统将个人信息置于危险之中。 零知识证明可以帮助个人验证身份，同时保护敏感信息。</p>
<p>零知识证明在去中心化身份的背景下特别有用。 去中心化身份（也称为“自我主权身份”）使个人能够控制对个人标识符的访问。 在不透露您的税号或护照详细信息的情况下证明您的公民身份是零知识技术如何实现去中心化身份的一个很好的例子。</p>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>使用在线服务需要证明您的身份和访问这些平台的权利。 这通常需要提供个人信息，例如姓名、电子邮件地址、出生日期等。 您可能还需要记住长密码，否则可能会失去访问权限。</p>
<p>然而，零知识证明可以简化平台和用户的身份验证。 一旦使用公共输入（例如，证明用户是平台成员的数据）和私人输入（例如，用户的详细信息）生成零知识证明，用户可以在需要访问时简单地出示它以验证其身份。 这改善了用户体验，并使组织无需存储大量用户信息。</p>
<h3 id="可验证计算"><a href="#可验证计算" class="headerlink" title="可验证计算"></a>可验证计算</h3><p>可验证计算是零知识技术改进区块链设计的另一种应用。 可验证计算允许我们将计算外包给另一个实体，同时保持可验证的结果。 该实体将结果连同证明程序已正确执行的证据一起提交。</p>
<p>可验证计算对于在不降低安全性的情况下提高区块链处理速度至关重要。 理解这一点需要了解扩展以太坊的提议解决方案的差异。</p>
<p>分片等链上扩展解决方案需要对区块链的基础层进行大量修改。 然而，这种方法非常复杂，实施中的错误可能会破坏以太坊的安全模型。</p>
<p>链下扩展解决方案不需要重新设计核心以太坊协议。 相反，他们依靠外包计算模型来提高以太坊基础层的吞吐量。</p>
<p>这是它在实践中的工作原理：</p>
<ul>
<li>以太坊不是处理每笔交易，而是将执行卸载到一个单独的链上。</li>
<li>处理交易后，另一条链返回结果以应用于以太坊的状态。</li>
</ul>
<p>这里的好处是以太坊不需要执行任何操作，只需要将外包计算的结果应用到它的状态。 这减少了网络拥塞并提高了交易速度（链下协议优化以加快执行速度）。</p>
<p>链需要一种方法来验证链下交易而不重新执行它们，否则链下执行的价值就会丢失。</p>
<p>这就是可验证计算发挥作用的地方。 当一个节点在以太坊之外执行交易时，它会提交一个零知识证明来证明链下执行的正确性。 此证明（称为有效性证明）保证交易有效，允许以太坊将结果应用于其状态——无需等待任何人对其提出异议。</p>
<p>零知识汇总和验证是两种链下扩展解决方案，它们使用有效性证明来提供安全的可扩展性。 这些协议在链下执行数千笔交易，并提交证明以在以太坊上进行验证。 一旦证明得到验证，这些结果就可以立即应用，从而允许以太坊处理更多交易，而无需增加基础层的计算。</p>
<h2 id="使用零知识证明的缺点"><a href="#使用零知识证明的缺点" class="headerlink" title="使用零知识证明的缺点"></a>使用零知识证明的缺点</h2><h3 id="硬件成本"><a href="#硬件成本" class="headerlink" title="硬件成本"></a>硬件成本</h3><p>生成零知识证明涉及非常复杂的计算，最好在专用机器上执行。 由于这些机器价格昂贵，它们通常是普通人买不起的。 此外，想要使用零知识技术的应用程序必须考虑硬件成本——这可能会增加最终用户的成本。</p>
<h3 id="证明验证费用"><a href="#证明验证费用" class="headerlink" title="证明验证费用"></a>证明验证费用</h3><p>验证证明还需要复杂的计算，并增加了在应用程序中实施零知识技术的成本。 这个成本在证明计算的上下文中特别相关。 例如，ZK-rollups 支付约 500,000 gas 来验证以太坊上的单个 ZK-SNARK 证明，而 ZK-STARKs 需要更高的费用。</p>
<h3 id="信任假设"><a href="#信任假设" class="headerlink" title="信任假设"></a>信任假设</h3><p>在 ZK-SNARK 中，公共参考字符串（公共参数）生成一次，可供希望参与零知识协议的各方重复使用。 公共参数是通过可信的设置仪式创建的，参与者被认为是诚实的。</p>
<p>但用户确实没有办法评估参与者的诚实度，用户必须相信开发人员的话。 ZK-STARK 没有信任假设，因为生成字符串时使用的随机性是可公开验证的。 与此同时，研究人员正在为 ZK-SNARKs 进行非可信设置，以提高证明机制的安全性。</p>
<h3 id="量子计算威胁"><a href="#量子计算威胁" class="headerlink" title="量子计算威胁"></a>量子计算威胁</h3><p>ZK-SNARK 使用椭圆曲线密码学 (ECDSA) 进行加密。 虽然 ECDSA 算法目前是安全的，但未来量子计算机的发展可能会打破其安全模型。</p>
<p>ZK-STARK 被认为不受量子计算的威胁，因为它使用抗碰撞哈希进行加密。 与椭圆曲线密码学中使用的公私密钥对不同，抗碰撞散列更难被量子计算算法破解。</p>
<h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=fOGdb1CTu5c">Computer Scientist Explains One Concept in 5 Levels of Difficulty | WIRED&gt; - Wired YouTube channel</a></p>
<p><a target="_blank" rel="noopener" href="https://www.alchemy.com/overviews/snarks-vs-starks">SNARKs vs. STARKS vs. Recursive SNARKs — Alchemy Overviews</a></p>
<p><a target="_blank" rel="noopener" href="https://www.altoros.com/blog/zero-knowledge-proof-improving-privacy-for-a-blockchain/">A Zero-Knowledge Proof: Improving Privacy on a Blockchain — Dmitry Lavrenov</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/coinmonks/zk-snarks-a-realistic-zero-knowledge-example-and-deep-dive-c5e6eaa7131c">zk-SNARKs — A Realistic Zero-Knowledge Example and Deep Dive — Adam Luciano</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/coinmonks/zk-starks-create-verifiable-trust-even-against-quantum-computers-dd9c6a2bb13d">ZK-STARKs — Create Verifiable Trust, even against Quantum Computers — Adam Luciano</a></p>
<p><a target="_blank" rel="noopener" href="https://vitalik.ca/general/2021/01/26/snarks.html">An approximate introduction to how zk-SNARKs are possible — Vitalik Buterin</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leewayhertz.com/zero-knowledge-proof-and-blockchain/">What is Zero-Knowledge Proof and Its Role in Blockchain? — LeewayHertz</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.he1pa.com/2023/01/01/2022%E5%B9%B4%E7%9A%84%E8%83%A1%E8%A8%80%E4%B9%B1%E8%AF%AD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/56333845?s=400&u=600fd5f50de976970544a4066a750cd59623091b&v=4">
      <meta itemprop="name" content="He1Pa">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Write the code, Change the world">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/01/2022%E5%B9%B4%E7%9A%84%E8%83%A1%E8%A8%80%E4%B9%B1%E8%AF%AD/" class="post-title-link" itemprop="url">2022的胡言乱语</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-01-01 22:48:32 / Modified: 23:11:37" itemprop="dateCreated datePublished" datetime="2023-01-01T22:48:32+08:00">2023-01-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%83%A1%E8%A8%80%E4%B9%B1%E8%AF%AD/" itemprop="url" rel="index"><span itemprop="name">胡言乱语</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/01/01/2022%E5%B9%B4%E7%9A%84%E8%83%A1%E8%A8%80%E4%B9%B1%E8%AF%AD/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/01/01/2022%E5%B9%B4%E7%9A%84%E8%83%A1%E8%A8%80%E4%B9%B1%E8%AF%AD/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>每一年的经历都很新奇，每一年的生活都很多彩。2022，又度过了神奇的一年。</p>
<p>2022从论文开始。2022年的元旦节，1月1号，我完成了硕士毕业论文的最后一章：致谢。我真的把这一章当作整个毕业论文最重要的一部分去写。感谢了父母，老师，同学，朋友，同事，两年来所有提供过帮助的人。四月份从学校毕业，在家被封控了一个月，生日当天从隔离点出来。五月来到杭州正式入职，完成学生到打工人的转变。5-12月就是上班-出去玩-上班-出去玩，最后一天以自驾150公里，在千岛湖看了场电影结束了。</p>
<p><img src="/2023/01/01/2022%E5%B9%B4%E7%9A%84%E8%83%A1%E8%A8%80%E4%B9%B1%E8%AF%AD/%E5%8D%83%E5%B2%9B%E6%B9%96.jpg" alt></p>
<p>今年去了很多地方。五月份正式搬到了杭州，这是应该是我长期居住的第三个城市。去了舟山，去了安吉，去了上海，去了千岛湖，还有大把时间挥霍在南京，我已经在这个城市呆了8年了，相比杭州我还挺喜欢南京的。</p>
<p>今年认识了很多新的朋友。公司的同事、大把神仙一样的高P大牛，新员工培训时各方面顶尖的同龄人。去考驾照认识了一个有点意思的小姐姐。但打游戏倒是没什么新的游戏好友，大概是生活太精彩了，游戏对我已经没什么吸引力了。</p>
<p>今年有了更多新奇的体验。去舟山赶海，去安吉滑雪，去千岛湖骑车，去了上海搞展，还在西湖边看大爷放风筝。在南京去看脱口秀，去看画展，去猫咖撸猫/狗，去吃了越南/印度各种各样神奇的菜，跟琪琪出去玩真的很开心。南图从我大一的时候就听说挺好，今年终于去了一次。唯一的遗憾是十一预约南博但没有预约成。</p>
<p>今年拼了两个乐高，老友记和杜卡迪。<br><img src="/2023/01/01/2022%E5%B9%B4%E7%9A%84%E8%83%A1%E8%A8%80%E4%B9%B1%E8%AF%AD/%E8%80%81%E5%8F%8B%E8%AE%B0.jpg" alt><br><img src="/2023/01/01/2022%E5%B9%B4%E7%9A%84%E8%83%A1%E8%A8%80%E4%B9%B1%E8%AF%AD/%E6%9D%9C%E5%8D%A1%E8%BF%AA.jpg" alt></p>
<p>今年在工作中写了一篇技术分享的长文，很受大家欢迎，github涨了接近200个star，OSChina上也有大几千的阅读，甚至准备以此为基础准备去写一本电子书，这是今年最有成就感的事。去年写的paper终于中了，虽然只是一个很水的会。但也是我中的第一篇paper。</p>
<p>今年也是摆烂的一年，勇于开坑但从不填坑。跟yyj搞arduboy游戏机因为太忙烂尾；《编译原理》《代码大全》《敏捷软件开发》几本书看了一半没有兴趣继续下去，唯一看完的是一本《人月神话》；上面的电子书已经烂尾；帮琪琪写的东西也一直没时间搞（这个尽量不烂尾&#x1F610;）;甚至几个游戏都烂掉不想玩了。人生嘛，总是在寻找自己爱的人和事，只是短暂爱过罢了。毕竟海誓山盟并不能够绑住我，一百年里我想爱的人(事)那么多。</p>
<p>今年又学了很多技能。学会了一点点rust，学了一点点kubernetes，对区块链和web3.0有了一点点了解，写了一点点llvm，也读了一丢丢《毛选》。自己买了个域名，搞了博客（👆就是你们看到的这个），虽然全是水文和自己的胡言乱语。工作上稍微搞了一下项目的微信公众号。今年leetcode提交了385次，AC了大概200多题，但某种意义上也是一种烂尾。年底终于去学了摩托车，也拿到了驾照，新的一年希望有机会多骑车，多和朋友一起出去骑车。</p>
<p>今年依旧花了很多时间打游戏。年初成为原批，毕业前打了几个月原神。依旧在打LOL，十年LOL我终于在下棋第一次打上了钻石，但rank越来越摆烂了。Apex依然又菜又爱玩。开始玩尘埃拉力赛，自己买了方向盘踏板和手刹。蹭了室友的switch和PS5，手柄用起来像个残疾人，还得是键鼠。玩了很多小游戏，破门而入(CQB)，boratato，死亡细胞，枪火重生（肉鸽）。<del>打游戏还是</del> 生活才是我的第一快乐源泉 。</p>
<p>今年是依旧单身的一年。</p>
<p>本来不想写太多跟工作相关的事情，就像我老板说的：“蚂蚁人的上限不应该只有375”。“程序员也不应该只为了工作和赚钱而活着”，这和我想做一个优秀的程序员应该也不矛盾（我觉得我还算是一个程序员，或者是编程爱好者？）。</p>
<p>Enjoy my fucking life!</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.he1pa.com/2022/12/09/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/56333845?s=400&u=600fd5f50de976970544a4066a750cd59623091b&v=4">
      <meta itemprop="name" content="He1Pa">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Write the code, Change the world">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/09/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/" class="post-title-link" itemprop="url">人月神话</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-12-09 17:26:07 / Modified: 18:10:38" itemprop="dateCreated datePublished" datetime="2022-12-09T17:26:07+08:00">2022-12-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%9A%E8%AF%BB%E4%B9%A6%E5%A4%9A%E7%9C%8B%E6%8A%A5/" itemprop="url" rel="index"><span itemprop="name">多读书多看报</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/12/09/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/12/09/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/zhengda/The-Mythical-Man-Month-zh">https://github.com/zhengda/The-Mythical-Man-Month-zh</a></p>
</blockquote>
<p>目录<br>第1章 焦油坑</p>
<ul>
<li><p>1.1 编程系统产品（Programming Systems Product）开发的工作量是供个人使用的、独立开发的构件程序的九倍。我估计软件构件产品化引起了3倍工作量，将软件构件整合成完整系统所需要的设计、集成和测试又强加了3倍的工作量，这些高成本的构件在根本上是相互独立的。</p>
</li>
<li><p>1.2 编程行业”满足我们内心深处的创造渴望和愉悦所有人的共有情感”，提供了五种乐趣：</p>
<ul>
<li>创建事物的快乐</li>
<li>开发对其他人有用的东西的乐趣</li>
<li>将可以活动、相互啮合的零部件组装成类似迷宫的东西，这个过程所体现出令人神魂颠倒的魅力</li>
<li>面对不重复的任务，不间断学习的乐趣</li>
<li>工作在如此易于驾驭的介质上的乐趣—纯粹的思维活动，其存在、移动和运转方式完全不同于实际物体</li>
</ul>
</li>
<li><p>1.3 同样，这个行业具有一些内在固有的苦恼：</p>
<ul>
<li>将做事方式调整到追求完美，是学习编程的最困难部分</li>
<li>由其他人来设定目标，并且必须依靠自己无法控制的事物（特别是程序）；权威不等同于责任</li>
<li>实际情况看起来要比这一点好一些：真正的权威来自于每次任务的完成</li>
<li>任何创造性活动都伴随着枯燥艰苦的劳动，编程也不例外</li>
<li>人们通常期望项目在接近结束时，（bug、工作时间）能收敛得快一些，然而软件项目的情况却是越接近完成，收敛得越慢</li>
<li>产品在即将完成时总面临着陈旧过时的威胁</li>
</ul>
</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/12/09/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.he1pa.com/2022/09/01/Rustc%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A002-CombinedLintPass/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/56333845?s=400&u=600fd5f50de976970544a4066a750cd59623091b&v=4">
      <meta itemprop="name" content="He1Pa">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Write the code, Change the world">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/09/01/Rustc%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A002-CombinedLintPass/" class="post-title-link" itemprop="url">Rustc源码学习02-CombinedLintPass</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-09-01 23:24:12" itemprop="dateCreated datePublished" datetime="2022-09-01T23:24:12+08:00">2022-09-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-31 18:29:49" itemprop="dateModified" datetime="2023-05-31T18:29:49+08:00">2023-05-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rust/" itemprop="url" rel="index"><span itemprop="name">Rust</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/09/01/Rustc%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A002-CombinedLintPass/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/09/01/Rustc%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A002-CombinedLintPass/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CombinedLintPass"><a href="#CombinedLintPass" class="headerlink" title="CombinedLintPass"></a>CombinedLintPass</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p><a target="_blank" rel="noopener" href="https://github.com/awesome-kusion/rust-code-book/blob/main/rust-tools/lint/lint-pass.md">前一篇文章</a> 介绍了关于 <code>Lint</code> 和 <code>LintPass</code> 的一些概念和实现。基于这些结构，提供了一个简易的 <code>Lint</code> 检查的实现方式。本文主要介绍 <code>CombinedLintPass</code> 这一结构的实现，并基于 <code>CombinedLintPass</code> 进一步优化 <code>Lint</code> 的实现。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/09/01/Rustc%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A002-CombinedLintPass/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="He1Pa"
      src="https://avatars.githubusercontent.com/u/56333845?s=400&u=600fd5f50de976970544a4066a750cd59623091b&v=4">
  <p class="site-author-name" itemprop="name">He1Pa</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/He1pa" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;He1pa" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:18012015693@163.com" title="E-Mail → mailto:18012015693@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">He1Pa</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '0ajXWqnokF3aIBvbGWl62uKn-gzGzoHsz',
      appKey     : '8M2ckzJi4U6v5MxlKf7NpRvY',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
